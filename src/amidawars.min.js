enchant();
var AW=function(E){var aa=function(){0===E.pageYOffset&&E.scrollTo(0,1)};E.onorientationchange=function(){setTimeout(aa,100)};E.addEventListener("load",E.onorientationchange,!1);var m,P,u={USER:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},ENEMY:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},MAP_OPTION:{CASTLE_BASE:new Group,THUMB_BASE:new Group},EFFECT:{UNIT:new Group}},C="",B={USER:{},ENEMY:{},no:0},Q={USER:[],ENEMY:[]},x={USER:[],ENEMY:[]},M={},J={},N={},O=[],F={USER:[],ENEMY:[]},R=[],G=
{},S,z=function(b,a){var h;void 0===b&&(b={});for(h in a)!0===a.hasOwnProperty(h)&&(b[h]=a[h]);return b},A=function(b){b.layer.addChild(b.sprite);return b.sprite};PUBLIC={};var K=function(){return{TIMELIMIT:function(){return 180},FONT:function(){return"monospace"},UNIT:function(){return{IMAGE:"img/char.gif",CHIP_SIZE:16,FRAME_SIZE:{W:4,H:3},FRAME_LINE:16,FRAME_BLOCK:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:4,KNIGHT:8,ARCHER:12,CLELIC:16,FIRE_MAGE:20,FROST_MAGE:24,WIZARD:28},UNDEAD:{BONE_DOG:32,BONE_WARRIER:36,
BONE_ARCHER:40,SPECTOR:44,BONE_SNAKE:48,GOLEM:52,SHADE:56,ARACHNE:60}},STATUS:{HUMAN:{WARRIOR:{name:"WARRIOR",race:"HUMAN",frame:0,hp:3,speed:2,siege:1,reverse:5,attacked:function(){},dead:function(){}},LANCER:{name:"LANCER",race:"HUMAN",frame:0,frame:4,hp:4,speed:2,siege:1,reverse:3,attacked:function(){},dead:function(){}},KNIGHT:{name:"KNIGHT",race:"HUMAN",frame:0,frame:8,hp:5,speed:1.8,siege:1,reverse:8,attacked:function(){},dead:function(){}},ARCHER:{name:"ARCHER",race:"HUMAN",frame:0,frame:12,
hp:2,speed:2.2,siege:1,reverse:4,attacked:function(){},dead:function(){}},CLELIC:{name:"CLELIC",race:"HUMAN",frame:0,frame:48,hp:2,speed:1,siege:1,reverse:3,attacked:function(){},dead:function(){}},FIRE_MAGE:{name:"FIRE_MAGE",race:"HUMAN",frame:0,frame:52,hp:2,speed:1.6,siege:1,reverse:4,attacked:function(){},dead:function(b){var b=b.mine,a=new H({type:b.type.toUpperCase(),etype:"FIRE",x:b.x,y:b.y,frames:CONST_CASH.EFFECT.FRAME.FIRE});setTimeout(function(){a.end()},1E4)}},FROST_MAGE:{name:"FROST_MAGE",
race:"HUMAN",frame:0,frame:56,hp:2,speed:1.6,siege:1,reverse:4,attacked:function(){},dead:function(b){var b=b.mine,a=new H({type:b.type.toUpperCase(),etype:"FROST",x:b.x,y:b.y,frames:CONST_CASH.EFFECT.FRAME.FROST});setTimeout(function(){a.end()},1E4)}},WIZARD:{name:"WIZARD",race:"HUMAN",frame:0,frame:60,hp:2,speed:1.6,siege:1,reverse:5,attacked:function(){},dead:function(){}}},UNDEAD:{BONE_DOG:{name:"BONE_DOG",race:"UNDEAD",frame:0,frame:96,hp:1,speed:2.8,siege:1,reverse:1,attacked:function(){},dead:function(){}},
BONE_WARRIER:{name:"BONE_WARRIER",race:"UNDEAD",frame:100,hp:2,speed:2,siege:1,reverse:1,attacked:function(){},dead:function(b){var a=b.mine,h=new H({type:a.type.toUpperCase(),etype:"BONE",x:a.x,y:a.y,frames:CONST_CASH.EFFECT.FRAME.BONE});setTimeout(function(){new I(z({mode:a.mode,x:a.x-16,y:a.y-16,moveVal:a.moveVal},CONST_CASH.UNIT.STATUS[a.race][a.name]));h.end()},5E3)}},BONE_ARCHER:{name:"BONE_ARCHER",race:"UNDEAD",frame:104,hp:1,speed:2,siege:1,reverse:1,attacked:function(){},dead:function(){}},
SHADE:{name:"SHADE",race:"UNDEAD",frame:108,hp:1,speed:1.8,siege:9,reverse:3,attacked:function(){},dead:function(){}},BONE_SNAKE:{name:"BONE_SNAKE",race:"UNDEAD",frame:144,hp:2,speed:2.6,siege:1,reverse:1,attacked:function(){},dead:function(){}},GOLEM:{name:"GOLEM",race:"UNDEAD",frame:148,hp:7,speed:1,siege:1,reverse:6,attacked:function(){},dead:function(){}},SPECTOR:{name:"SPECTOR",race:"UNDEAD",frame:152,hp:1,speed:1.8,siege:0,reverse:3,attacked:function(){},dead:function(){}},ARACHNE:{name:"ARACHNE",
race:"UNDEAD",frame:156,hp:3,speed:2,siege:1,reverse:4,attacked:function(b){b=b.enemy;b.reverse=9;b.speed/=2},dead:function(){}}}},AI:{USER:[{direction:0,prop:"y",sign:-1,order:[1,3,0,2]},{direction:3,prop:"x",sign:-1,order:[0,2,3,1]},{direction:1,prop:"x",sign:1,order:[0,2,1,3]},{direction:2,prop:"y",sign:1,order:[3,1,2,0]}],ENEMY:[{direction:2,prop:"y",sign:1,order:[3,1,2,0]},{direction:3,prop:"x",sign:-1,order:[2,0,3,1]},{direction:1,prop:"x",sign:1,order:[2,0,1,3]},{direction:0,prop:"y",sign:-1,
order:[3,1,0,2]}]}}},THUMB:function(){return{IMAGE:"img/thumb.png",CHIP_SIZE:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:1,KNIGHT:2,ARCHER:3,CLELIC:4,FIRE_MAGE:5,FROST_MAGE:6,WIZARD:7},UNDEAD:{BONE_DOG:8,BONE_SNAKE:9,BONE_WARRIER:10,BONE_ARCHER:11,GOLEM:12,ARACHNE:13,SHADE:14,SPECTOR:15}},USER:{POSITION:[[0,384],[48,384],[96,384],[144,384],[0,432],[48,432],[96,432],[144,432]]},ENEMY:{},PROP:{}}},SCORE:function(){return{POSITION:[20,7]}},COUNTDOWN:function(){return{POSITION:[200,7]}},STATUS_VIEWER:function(){return{IMAGE:"img/window_status.png",
POSITION:[192,384],BG_SIZE:[128,96]}},MAP:function(){return{IMAGE:"img/map.png",W:320,H:480,CHIP_SIZE:32}},CASTLE:function(){return{FRAME:[{NORMAL:8,BRAKE:9},{NORMAL:10,BRAKE:11},{NORMAL:12,BRAKE:13},{NORMAL:14,BRAKE:15}],PROP:{frame:0,brake:0,hp:2,mhp:2,unitX:0,unitY:0}}},EFFECT:function(){return{IMAGE:"img/effect.gif",FRAME:{EXPLOSION:{start:0,end:5,rate:3,loop:!1},FIRE:{start:6,end:8,rate:50,loop:!0},FROST:{start:12,end:12,rate:1E3,loop:!0},BONE:{start:18,end:18,rate:1E3,loop:!0}}}},SOUND:function(){return{BGM:"sound/bgm.wav",
EFFECT:{EXPLOSION:"sound/explosion.wav"}}},TYPE:function(){return{CASTLE:"CASTLE",THUMB:"THUMB",UNIT:"UNIT",EFFECT:"EFFECT"}},HAVE:function(){return{USER:"USER",ENEMY:"ENEMY"}},POINT:function(){return{UNIT:10,CASTLE:1E3,WIN:5E3,LOSE:-5E3,TIME:100}}}};CONST_CASH=K();CONST_CASH={TIMELIMIT:CONST_CASH.TIMELIMIT(),FONT:CONST_CASH.FONT(),UNIT:CONST_CASH.UNIT(),THUMB:CONST_CASH.THUMB(),SCORE:CONST_CASH.SCORE(),COUNTDOWN:CONST_CASH.COUNTDOWN(),STATUS_VIEWER:CONST_CASH.STATUS_VIEWER(),MAP:CONST_CASH.MAP(),
CASTLE:CONST_CASH.CASTLE(),EFFECT:CONST_CASH.EFFECT(),SOUND:CONST_CASH.SOUND(),TYPE:CONST_CASH.TYPE(),HAVE:CONST_CASH.HAVE(),POINT:CONST_CASH.POINT()};var U=function(){var b=CONST_CASH.THUMB,a=b.CHIP_SIZE,h=b.FRAME.HUMAN,i=b.FRAME.UNDEAD,e=new Scene,g=m.assets[b.IMAGE],c=m.assets[CONST_CASH.STATUS_VIEWER.IMAGE],d=new Group,j=new Sprite(a,a),f=new Label,k=new Label,l=new Sprite(250,100),r=new Group,a=new Sprite(a,a),o=new Label,s=new Label,p=new Sprite(250,100),v=function(a){var c,d,e,f,h=new Label,
g=Q.USER,i=CONST_CASH.HAVE.USER,j=b.USER.POSITION,k=b.FRAME;C=a.race;e=a.order;c=0;for(d=e.length;c<d;c++)a=e[c].toUpperCase(),f=j[c],g[c]=new T({mode:i,name:a,frame:k[C][a],x:f[0],y:f[1]});h.text="\u2462";h.font="150px/1.5 "+CONST_CASH.FONT;h.color="#fff";h.x=90;h.y=100;m.rootScene.addChild(h);N.init();m.popScene();aid=setTimeout(function(){h.text="\u2461";aid=setTimeout(function(){h.text="\u2460";aid=setTimeout(function(){G.vibrate(3);c=0;for(d=e.length;c<d;c++)g[c].init();q.init();D.init();J.init();
m.rootScene.removeChild(h)},1E3)},1E3)},1E3);return C};e.backgroundColor="rgba(0,0,0,0.3)";j.image=a.image=g;l.image=p.image=c;l.frame=p.frame=1;d.addChild(l);r.addChild(p);d.x=r.x=35;d.y=100;r.y=220;j.frame=h.KNIGHT;a.frame=i.BONE_WARRIER;j.x=a.x=5;j.y=a.y=5;f.font=k.font=o.font=s.font="12px/1.5 "+CONST_CASH.FONT;f.color=k.color=o.color=s.color="#ddd";f.text="<b>HUMAN</b>";o.text="<b>UNDEAD</b>";k.text="\u4f7f\u3044\u3084\u3059\u304f\u3001\u9ad8\u6027\u80fd\u306a\u7a2e\u65cf\u3002\u30d0\u30e9\u30f3\u30b9\u304c\u826f\u304f\u6271\u3044\u3084\u3059\u3044\u3002";
s.text="\u6271\u3044\u3065\u3089\u3044\u5c16\u3063\u305f\u6027\u80fd\u3092\u6301\u3064\u30e6\u30cb\u30c3\u30c8\u304c\u591a\u3044\u7a2e\u65cf\u3002<br />\u64cd\u4f5c\u91cf\u306b\u81ea\u4fe1\u304c\u3042\u308b\u4eba\u5411\u3051\u3002";f.x=o.x=50;f.y=o.y=5;k.width=s.width=200;k.x=s.x=50;k.y=s.y=23;d.addChild(j);d.addChild(f);d.addChild(k);r.addChild(a);r.addChild(o);r.addChild(s);e.addChild(d);e.addChild(r);d.addEventListener(enchant.Event.TOUCH_END,function(){return v({race:"HUMAN",order:"LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")})});
r.addEventListener(enchant.Event.TOUCH_END,function(){return v({race:"UNDEAD",order:"BONE_WARRIER,BONE_ARCHER,BONE_DOG,BONE_SNAKE,GOLEM,ARACHNE,SHADE,SPECTOR".split(",")})});m.pushScene(e);return{select:v}},$=function(){var b=CONST_CASH.MAP.CHIP_SIZE,a=O,h=new Map(b,b),i=m.assets[CONST_CASH.MAP.IMAGE],e=u.USER,g=u.ENEMY,c=CONST_CASH.CASTLE.FRAME,d=CONST_CASH.HAVE.USER,j=u.MAP_OPTION.CASTLE_BASE,f=u.MAP_OPTION.THUMB_BASE,k=u.EFFECT.UNIT,l=m.rootScene,r=CONST_CASH.UNIT.CHIP_SIZE,o=CONST_CASH.SCORE.POSITION,
s,p=CONST_CASH.COUNTDOWN.POSITION,v=CONST_CASH.STATUS_VIEWER.POSITION,L,w,n;P=document.getElementById("enchant-stage");n=P.style;h.image=i;h.loadData(a);h.vibrate=function(b){b+="px";clearInterval(w);w=setTimeout(function(){n.top=0;n.left=b;w=setTimeout(function(){n.top=b;n.left=0;w=setTimeout(function(){n.top=0;n.left="-"+b;w=setTimeout(function(){n.top=0;n.left=0},30)},30)},30)},30)};h.getSquere=function(c){var a,d,e=Math.floor;h.getSquere=function(c){a=e(c.x/b);d=e(c.y/b);return{x:a,y:d}};return h.getSquere(c)};
h.getCollision=function(b){var c=h.getSquere(b),a=R,e=!1,f,g,i;if((a=a[c.y])&&(a=a[c.x]))if(1===a[0]+a[1]+a[2]+a[3])for(f in x){if(!0===x.hasOwnProperty(f)){g=x[f];c=0;for(a=g.length;c<a;c++)if(i=g[c],!0===b.intersect(i)){e=!0===i.checkBreak()?i.mode!==d?[0,0,1,0]:[1,0,0,0]:i;break}}}else e=a;return e};G=h;statusViewer=N=new V({mode:d,x:v[0],y:v[1]});a=M=new W({mode:d,x:o[0],y:o[1]});s=J=new X({x:p[0],y:p[1]});s.update();for(L in F)if(!0===F.hasOwnProperty(L)){o=F[L];p=0;for(i=o.length;p<i;p++)v=
new Y({mode:L,frame:c[p].NORMAL,brake:c[p].BRAKE,x:o[p][0]*b,y:o[p][1]*b}),v.unitX=v.x+r/2,v.unitY=v.y+r/2}l.addChild(h);l.addChild(j);l.addChild(statusViewer);l.addChild(f);l.addChild(g.CASTLE);l.addChild(g.UNIT);l.addChild(e.UNIT);l.addChild(e.CASTLE);l.addChild(e.THUMB);l.addChild(g.THUMB);l.addChild(k);l.addChild(a.label);l.addChild(s);S=m.assets[CONST_CASH.SOUND.EFFECT.EXPLOSION];y.init();(function(){var c=!1,b=function(){new Z(c);t.end();D.end();s.stop();m.end();q.end()};t.add(function(){return!0===
gameStart?(new U,s.setAfter(function(){c=!0;b();return!0}),t.remove("playStart"),!0):!1},"playStart");t.add(function(){var a,d,e,f,h,g;if(!1!==c)return b(),!0;for(a in x)if(!0===x.hasOwnProperty(a)){f=x[a];e=f.length;for(d=g=0;d<e&&!(h=f[d],0<h.hp);d++)g++;if(g===e){c=a;break}}return!1},"playEnd");t.init()})();return h},Y=function(b){var a=CONST_CASH.MAP.CHIP_SIZE,h=m.assets[CONST_CASH.MAP.IMAGE],i=K().CASTLE().PROP,e=b.mode.toUpperCase(),g=CONST_CASH.HAVE,c=new Sprite(a,a),d=u.MAP_OPTION.CASTLE_BASE,
j=-1,f,a=new Sprite(a,a);a.image=h;a.frame=24;e===g.USER&&(a.frame=16);a.x=b.x;a.y=b.y;A({layer:d,sprite:a});i.base=a;i=z(i,b);c.image=h;c=z(c,i);c.type=CONST_CASH.TYPE.CASTLE;x[e].push(c);c.focusOn=function(){c.scaleX=c.scaleY=1.4;c.focus=true};c.focusOff=function(){c.scaleX=c.scaleY=1;c.focus=false};f=function(){if(m.frame%2===0){c.opacity=c.opacity+0.1*j;c.opacity<=0.5?j=1:c.opacity>=1&&(j=-1)}};c.blinkOn=function(){c.addEventListener(enchant.Event.ENTER_FRAME,f)};c.blinkOff=function(){c.removeEventListener(enchant.Event.ENTER_FRAME,
f);c.opacity=1};c.damage=function(a){c.hp=c.hp-a.siege;if(c.hp<=0){c.hp=0;c.broke()}else if(c.mhp/2>=c.hp)c.frame=c.brake};c.broke=function(){c.hp=c.opacity=c.base.opacity=0};c.checkBreak=function(){return c.hp===0?true:false};return A({layer:u[e].CASTLE,sprite:c})},T=function(b){var a=CONST_CASH.THUMB.CHIP_SIZE,h=m.assets[CONST_CASH.THUMB.IMAGE],i=K().THUMB().PROP,e=CONST_CASH.UNIT.STATUS[C][b.name],g=b.mode.toUpperCase(),c=new Sprite(a,a),a=new Sprite(a,a),d,j,f,k,l=enchant.Event,r=N,o=new Label;
a.image=h;a.frame=16;a.x=b.x;a.y=b.y;A({layer:u.MAP_OPTION.THUMB_BASE,sprite:a});o.text=Math.ceil(e.reverse);o.font="24px "+CONST_CASH.FONT;o.color="#ccc";o.x=b.x+17;o.y=b.y+7;A({layer:u.MAP_OPTION.THUMB_BASE,sprite:o});i=z(i,b);c.image=h;c=z(c,i);c.unit={mode:g};c.unit=z(c.unit,e);c.type=CONST_CASH.TYPE.THUMB;f=c.x;k=c.y;c.addEventListener(l.TOUCH_START,function(a){!0===this.canDrag&&(d=a.x-this.x,j=a.y-this.y);r.update(c.unit)});c.addEventListener(l.TOUCH_MOVE,function(a){!0===this.canDrag&&(this.x=
a.x-d,this.y=a.y-j)});c.addEventListener(l.TOUCH_END,function(){if(!0===this.canDrag){var a;a=!1;var c=x.USER,b,d,e;d=0;for(e=c.length;d<e;d++)if(b=c[d],!0===this.intersect(b)){a=b;break}!1!==a&&(this.dragStop(),this.unit.x=a.unitX,this.unit.y=a.unitY,this.lastUnit=new I(this.unit),this.lastUnit.thumb=this);this.x=f;this.y=k}});c.dragStart=function(){c.canDrag=!0;c.opacity=1};c.dragStop=function(){c.canDrag=!1;c.opacity=0};c.reverse=function(a){var b=Math.ceil(a.reverse),d=setInterval(function(){b--;
o.text=b;0===b&&(o.text="",c.dragStart(),clearInterval(d))},1E3);o.text=b;c.opacity=0.3;return!0};Q[g].push(c);c.dragStop();c.opacity=0.3;c.init=function(){return c.reverse(c.unit)};return A({layer:u[g].THUMB,sprite:c})},I=function(b){var a=CONST_CASH.UNIT.CHIP_SIZE,h=CONST_CASH.MAP.CHIP_SIZE,i=a/2,e=i,g=m.assets[CONST_CASH.UNIT.IMAGE],c=b.mode.toUpperCase(),d=new Sprite(a,a),j=new Label,f=CONST_CASH.HAVE,k=CONST_CASH.UNIT.FRAME_LINE,l=0,r=0,o=CONST_CASH.UNIT.AI[c],s,p,v,t,w,n;d.direction=0;d.image=
g;d=z(d,b);d.moveVal&&(e=d.moveVal);d.hplabel=j;j.x=b.x-2;j.y=b.y-14;j.font="9px "+CONST_CASH.FONT;j.color="#FAA";j.backgroundColor="rgba(0,0,0,0.5)";j.width=20;j.update=function(){j.text="\u2020"+d.hp};j.update();A({layer:u[c].UNIT,sprite:j});d.type=CONST_CASH.TYPE.UNIT;d.attack=function(a,b){a.hp=a.hp-b;d.attacked({mine:a,enemy:d});a.hplabel.update();if(a.hp<=0){a.moveVal=e;a.dead({mine:a,enemy:d});a.kill()}return a.hp};d.kill=function(){var b=d.x,m=d.y;new H({type:d.type.toUpperCase(),x:b,y:m,
frames:CONST_CASH.EFFECT.FRAME.EXPLOSION});S.play();delete B[c][d.myNo];u[c].UNIT.removeChild(d);u[c].UNIT.removeChild(j);typeof d.after_death==="function"&&setTimeout(function(){d.after_death(d)},d.reverse*1E3);d.thumb!==void 0&&d.thumb.reverse(d);d.removeEventListener(enchant.Event.ENTER_FRAME,n);d.removeEventListener(enchant.Event.ENTER_FRAME,w);setTimeout(function(){a=h=i=e=g=c=j=f=k=l=o=p=v=t=w=n=null},10);return true};d.checkDeath=function(){return d.hp<=0?true:false};s=d.frame;d.changeUnit=
function(a){s=a.frame;return true};p=function(){return G.getSquere(d)};d.beforePoint=p();v=function(){var a=false;if(e>=h){var b,c=d.beforePoint;e=e-h;if(e>0){switch(d.direction){case 0:d.y=d.y+e;break;case 1:d.x=d.x-e;break;case 2:d.y=d.y-e;break;case 3:d.x=d.x+e}d.y=Math.round(d.y);d.x=Math.round(d.x)}e=0;b=p();if(b.x!==c.x||b.y!==c.y)a=true}return a};t=function(){return G.getCollision(d)};w=function(){if(m.frame%5===0){l++;switch(l){case 4:l=0;r=-1;break;case 3:r=0}r++}d.frame=s+r*k+d.direction};
n=function(){var a=d.direction,b=d.speed,c=CONST_CASH.TYPE,f,h=o.length,g,i;n=function(){if(m.frame%3===0){e=e+b;for(f=0;f<h;f++){g=o[f];if(a===g.direction){d[g.prop]=d[g.prop]+b*g.sign;j[g.prop]=j[g.prop]+b*g.sign;if(v()===true){i=t();if(i!==false)i.type!==c.CASTLE?d.direction=i[g.order[0]]===1?g.order[0]:i[g.order[1]]===1?g.order[1]:i[g.order[2]]===1?g.order[2]:g.order[3]:y.siege(d,i)}break}}}};n()};d.addEventListener(enchant.Event.ENTER_FRAME,n);d.addEventListener(enchant.Event.ENTER_FRAME,w);
d.stay=function(){u[c].UNIT.removeChild(j);d.removeEventListener(enchant.Event.ENTER_FRAME,n);return true};d.myNo=B.no;B[c][B.no]=d;B.no++;c===f.USER&&(e=-e,j.color="#AAF");q.unit(d);return A({layer:u[c].UNIT,sprite:d})},W=function(b){var a=CONST_CASH.HAVE,h=b.mode,i=b.x,b=b.y,e=new Label,g={},c=function(a){g.total+=a;return g.total};e.font="12px "+CONST_CASH.FONT;e.color="#ccc";e.x=i;e.y=b;g={label:e,total:0,rate:0.5,mode:h,point:K().POINT,add:c,update:function(){}};h===a.USER&&(g.update=function(){e.text=
"SCORE : "+g.total},g.get=function(){return g.total},g.add=function(a){c(a);g.update();return g.total},g.rate=1);g.update();return g},X=function(b){var a=new Label,h=CONST_CASH.TIMELIMIT,i=0,e,g=function(){};a.font="12px "+CONST_CASH.FONT;a.color="#ccc";a.x=b.x;a.y=b.y;a.update=function(){a.text="TIME-LIMIT : "+(h-i);return a.text};a.init=function(){a.stop();e=setInterval(function(){i++;i>=h&&(g(),a.stop());a.update()},1E3);return!0};a.setAfter=function(a){return g=a};a.getDiff=function(){return h-
i};a.stop=function(){clearInterval(e);return!0};return a},H=function(b){var a=CONST_CASH.UNIT.CHIP_SIZE,h=b.frames,i=h.start,e=h.end,g=h.rate,c=h.loop,d=b.type.toUpperCase(),j=u.EFFECT[d],f=new Sprite(a,a),k;k=!0===c?function(){0===m.frame%g&&(f.frame<e?f.frame++:f.frame=i)}:function(){0===m.frame%g&&(f.frame>=e?f.end():f.frame++)};f.image=m.assets[CONST_CASH.EFFECT.IMAGE];f.x=b.x;f.y=b.y;f.frame=i;f.effect=k;f.endFlg=!1;f.addEventListener(enchant.Event.ENTER_FRAME,k);f.end=function(){f.removeEventListener(enchant.Event.ENTER_FRAME,
k);j.removeChild(f);f.endFlg=!0;setTimeout(function(){a=h=i=e=g=c=d=j=f=k=null},10);return!0};return A({layer:j,sprite:f})},D={aiid:null,race:"",order:[],init:function(){var b=D,a=CONST_CASH.HAVE.ENEMY,h,i,e,g=x.ENEMY,c=g.length,d=CONST_CASH.UNIT.STATUS,j,f,k;switch(C){case "HUMAN":b.race="UNDEAD";b.order="BONE_DOG,BONE_WARRIER,BONE_ARCHER,SHADE,BONE_SNAKE,GOLEM,SPECTOR,ARACHNE".split(",");break;default:b.race="HUMAN",b.order="LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")}d=
d[b.race];j=b.order;b.aiid=setInterval(function(){f=j.length;0<f&&(e=Math.floor(Math.random()*c),e>=c&&(e=c-1),h=g[e],e=Math.floor(Math.random()*f),e>=f&&(e=f-1),k=j[e],i=d[k],j.splice(e,1),e={mode:a,direction:2,x:h.unitX,y:h.unitY,after_death:function(a){j.push(a.name)}},e=z(e,i),i=new I(e))},6E3)},end:function(){clearInterval(D.aiid);D.aiid=null}},y={init:function(){var b=function(){var a=B.USER,h=B.ENEMY,i,e,g,c;b=function(){for(g in h)if(!0===h.hasOwnProperty(g))for(c in e=h[g],a)!0===a.hasOwnProperty(c)&&
(i=a[c],!0===e.intersect(i)&&(i.x===e.x||i.y===e.y)&&y.unitAndUnit(e,i))};return b()};t.add(b,"battle");return b},score:function(b){var a=CONST_CASH.HAVE,h=CONST_CASH.TYPE,i=M,e=CONST_CASH.POINT,g,c,d;y.score=function(b){g=b.mode;c=b.type;d=null;c!==h.CASTLE&&g===a.USER||c===h.CASTLE&&g===a.ENEMY?d=e[c]:c===h.CASTLE&&g===a.USER&&(d=-e[c]);i.add(d);return d};return y.score(b)},unitAndUnit:function(b,a){for(var h=b.hp,i=a.hp,e=h,g=i;0<h&&0<i;)h=b.attack(a,e),i=a.attack(b,g);!0===b.checkDeath()&&(q.death(b),
y.score(b));!0===a.checkDeath()&&(q.death(a),y.score(a))},siege:function(b,a){q.siege(a);a.damage(b);b.kill();G.vibrate(3);!0===a.checkBreak()&&(q.castle(a),y.score(a))}},t={functions:{},exefunc:function(){var b,a=[],h=t.functions;for(b in h)!0===h.hasOwnProperty(b)&&a.push(h[b]());return a},add:function(b,a){t.functions[a]=b},remove:function(b){delete t.functions[b]},init:function(){m.addEventListener(enchant.Event.ENTER_FRAME,t.exefunc,!1)},stop:function(){m.removeEventListener(enchant.Event.ENTER_FRAME,
t.exefunc,!1)},end:function(){t.functions={};t.stop()}},V=function(){var b=new Label,a=new Group,h,i=CONST_CASH.STATUS_VIEWER,e=i.POSITION,g=m.assets[i.IMAGE],i=i.BG_SIZE,c=new Sprite(i[0],i[1]),d=CONST_CASH.UNIT.STATUS,i=CONST_CASH.HAVE.USER,j={};a.x=e[0];a.y=e[1];c.image=g;c.frame=0;c.opacity=0;b.font="9px/1.5 "+CONST_CASH.FONT;b.color="#fff";b.text="";b.x=45;b.y=8;h=new I({mode:i,x:15,y:15,opacity:0});h.frame=0;h.direction=2;h.stay();a.update=function(c){h.opacity=1;a.update=function(a){b.text=
j[a.name];h.changeUnit(a);return!0};return a.update(c)};a.init=function(){var a,b,e=d[C];for(a in e)!0===e.hasOwnProperty(a)&&(b=e[a],j[a]="<b>"+b.name+"</b><br />\u2020: "+b.hp+"<br />\u21d2: "+b.speed+"/frame<br />\u00d7: "+b.reverse+"sec");c.opacity=1;return j};a.addChild(c);a.addChild(b);a.addChild(h);return a},q={logid:0,data:{time:0,victory:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}},unit:function(b){q.data.unit[b.mode]++},death:function(b){q.data.death[b.mode]++},
siege:function(b){q.data.siege[b.mode]++},castle:function(b){q.data.castle[b.mode]++},send:function(){q.data.time=J.getDiff();return!0},reset:function(){q.data={time:0,victory:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}}},init:function(){q.reset();return!0},end:function(){q.send();clearInterval(q.logid);return!0}},Z=function(b){var a=new Scene,h=new Label,i=new Label,e=CONST_CASH.HAVE,g=M.get(),c=CONST_CASH.POINT,d;d="SCORE: "+g+"<br>";switch(b){case e.ENEMY:b=
"WIN";q.data.victory=1;e=J.getDiff()*c.TIME;d+="&nbsp;WIN: "+c.WIN+"<br>&nbsp;CLEAR TIME BONUS: "+e;g+=c.WIN+e;break;case e.USER:b="LOSE";q.data.victory=-1;d+="&nbsp;LOSE: "+c.LOSE;g+=c.LOSE;break;default:b="DRAW",d+="&nbsp;DRAW: 0"}c=CONST_CASH.FONT;h.font="20px/1.5 "+c;h.color="#fff";h.text="RESULT";h.x=100;h.y=100;i.font="12px/1.5 "+c;i.color="#fff";i.text=d+("<br><br><b>TOTAL: "+g+"</b>");i.x=100;i.y=150;a.addChild(h);a.addChild(i);a.backgroundColor="rgba(0,0,0,0.3)";a.result=b;m.pushScene(a);
m.end(g,b+":"+g);return a};return PUBLIC={GAME:m,Amida:$,Battle:y,Castle:Y,CONST:CONST_CASH,Countdown:X,Effect:H,EnemyAction:D,init:function(b){var a=CONST_CASH.UNIT.IMAGE,h=CONST_CASH.THUMB.IMAGE,i=CONST_CASH.MAP.IMAGE,e=CONST_CASH.EFFECT.IMAGE,g=CONST_CASH.STATUS_VIEWER.IMAGE,c=CONST_CASH.SOUND.EFFECT.EXPLOSION,d=CONST_CASH.MAP.W,j=CONST_CASH.MAP.H,f,k;O=b=b.map;f=0;for(k=b.length;f<k;f++)b[f]=b[f].split("");f={"0":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,24:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,
35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,25:[0,0,1,0],99:[1,0,0,0],16:[1,0,1,0],17:[0,1,0,1],18:[1,1,1,0],19:[1,0,1,1],20:[0,1,1,0],21:[0,0,1,1],22:[1,1,0,0],23:[1,0,0,1]};var l,r,o,s,p,q=[],b=[].concat([[26,27,28,29,30,31,32,33,34,35],[0,1,1,1,1,1,1,1,1,2]],b,[[5,6,6,6,6,6,6,6,6,7],[36,37,38,39,40,41,42,43,44,45],[46,47,48,49,50,51,52,46,47,48],[49,50,51,52,51,52,46,47,48,49]]);k=0;for(r=b.length;k<r;k++){s=q[k]=[];p=b[k];8===p.length&&(b[k]=p=["3"].concat(p,
"4"));l=0;for(o=p.length;l<o;l++){var t=p,u=l,n=p[l];switch(n){case "\u2502":n=16;break;case "\u2500":n=17;break;case "\u251c":n=18;break;case "\u2524":n=19;break;case "\u250c":n=20;break;case "\u2510":n=21;break;case "\u2514":n=22;break;case "\u2518":n=23;break;case "\u00d7":n=24;break;case "\u25a0":n=25;break;case "\u25a1":n=99}t[u]=n;s[l]=f[p[l]];switch(p[l]){case 25:F.ENEMY.push([l,k]);break;case 99:F.USER.push([l,k]),p[l]=25}}}O=b;R=q;AW.GAME=m=new Game(d,j);m.preload(a,h,i,e,g,c);m.onload=$;
m.start()},Log:q,RaceSelect:U,RandamMap:function(){var b=["\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),
"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1".split(",")],a=b.length-2,h=b[0].length-2,i=[],e,g,c,d,j,f,k;c=Math.floor;var l=Math.random;for(e=0;4>e;e++){d=2*e;j=c(l()*a)+1;for(g=1;g<=a;g++)f=b[g],g===j?(f[d]="\u2514",f[d+1]="\u2510",d+=1):f[d]="\u2502"}for(e=0;e<h;e++)for(g=1;g<=a;g++)f=b[g],j=f[e],"\u2502"===j&&(j=f[e+1],d=f[e+2],k=f[e+3],("\u2502"===j||"\u00d7"===j&&"\u2502"===d||7>=e+3&&"\u00d7"===j&&"\u00d7"===d&&
"\u2502"===k)&&i.push({x:e,y:g}));a=i.length-1;for(e=0;100>e;e++)j=c(l()*a)+1,f=i[0],i[0]=i[j],i[j]=f;for(e=0;e<i.length&&3>e;e++)f=i[e],c=f.x,d=f.y,f=b[d],j=c+1,d=c+2,k=c+3,"\u2502"===f[c]&&"\u2502"===f[j]?(f[c]="\u251c",f[j]="\u2524"):"\u2502"===f[c]&&"\u00d7"===f[j]&&"\u2502"===f[d]?(f[c]="\u251c",f[j]="\u2500",f[d]="\u2524"):"\u2502"===f[c]&&"\u00d7"===f[j]&&"\u00d7"===f[d]&&"\u2502"===f[k]?(f[c]="\u251c",f[j]="\u2500",f[d]="\u2500",f[k]="\u2524"):(i.splice(e,1),e--);e=0;for(a=b.length;e<a;e++)b[e]=
b[e].join("");return b},Result:Z,Score:W,StatusViwer:V,Surveillant:t,Thumb:T,Unit:I}}(window);AW.init({map:"\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7,\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502\u00d7,\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524\u00d7,\u2502\u00d7\u2514\u2510\u2502\u00d7\u2502\u00d7,\u2514\u2510\u00d7\u251c\u2524\u00d7\u2514\u2510,\u00d7\u2502\u00d7\u2502\u2514\u2510\u00d7\u2502,\u00d7\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502,\u00d7\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524,\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1".split(",")});
