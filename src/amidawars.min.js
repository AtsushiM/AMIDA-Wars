enchant();
var AW=function(A){var aa=function(){0===A.pageYOffset&&A.scrollTo(0,1)};A.onorientationchange=function(){setTimeout(aa,100)};A.addEventListener("load",A.onorientationchange,!1);var n,P,r={USER:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},ENEMY:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},MAP_OPTION:{CASTLE_BASE:new Group,THUMB_BASE:new Group},EFFECT:{UNIT:new Group}},B="",x={USER:{},ENEMY:{},no:0},Q={USER:[],ENEMY:[]},w={USER:[],ENEMY:[]},M={},H={},N={},O=[],C={USER:[],ENEMY:[]},R=[],D=
{},S,y=function(b,c){var h;void 0===b&&(b={});for(h in c)!0===c.hasOwnProperty(h)&&(b[h]=c[h]);return b},v=function(b){b.layer.addChild(b.sprite);return b.sprite};PUBLIC={};var J=function(){return{TIMELIMIT:function(){return 180},FONT:function(){return"monospace"},UNIT:function(){return{IMAGE:"img/char.gif",CHIP_SIZE:16,FRAME_SIZE:{W:4,H:3},FRAME_LINE:16,FRAME_BLOCK:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:4,KNIGHT:8,ARCHER:12,CLELIC:16,FIRE_MAGE:20,FROST_MAGE:24,WIZARD:28},UNDEAD:{BONE_DOG:32,BONE_WARRIER:36,
BONE_ARCHER:40,SPECTOR:44,BONE_SNAKE:48,GOLEM:52,SHADE:56,ARACHNE:60}},STATUS:{HUMAN:{WARRIOR:{name:"WARRIOR",frame:0,hp:3,speed:2,siege:1,reverse:5,attacked:function(){},dead:function(){}},LANCER:{name:"LANCER",frame:4,hp:4,speed:2,siege:1,reverse:3,attacked:function(){},dead:function(){}},KNIGHT:{name:"KNIGHT",frame:8,hp:5,speed:1.8,siege:1,reverse:8,attacked:function(){},dead:function(){}},ARCHER:{name:"ARCHER",frame:12,hp:2,speed:2.2,siege:1,reverse:4,attacked:function(){},dead:function(){}},
CLELIC:{name:"CLELIC",frame:48,hp:2,speed:1,siege:1,reverse:3,attacked:function(){},dead:function(){}},FIRE_MAGE:{name:"FIRE_MAGE",frame:52,hp:2,speed:1.6,siege:1,reverse:4,attacked:function(){},dead:function(b){b=b.mine;b=new I({type:b.type.toUpperCase(),x:b.x,y:b.y,frames:CONST_CASH.EFFECT.FRAME.FIRE});v({layer:r.EFFECT.UNIT,sprite:b})}},FROST_MAGE:{name:"FROST_MAGE",frame:56,hp:2,speed:1.6,siege:1,reverse:4,attacked:function(){},dead:function(b){b=b.mine;b=new I({type:b.type.toUpperCase(),x:b.x,
y:b.y,frames:CONST_CASH.EFFECT.FRAME.FROST});v({layer:r.EFFECT.UNIT,sprite:b})}},WIZARD:{name:"WIZARD",frame:60,hp:2,speed:1.6,siege:1,reverse:5,attacked:function(){},dead:function(){}}},UNDEAD:{BONE_DOG:{name:"BONE_DOG",frame:96,hp:1,speed:2.8,siege:1,reverse:1,attacked:function(){},dead:function(){}},BONE_WARRIER:{name:"BONE_WARRIER",frame:100,hp:2,speed:2,siege:1,reverse:1,attacked:function(){},dead:function(){}},BONE_ARCHER:{name:"BONE_ARCHER",frame:104,hp:1,speed:2,siege:1,reverse:1,attacked:function(){},
dead:function(){}},SHADE:{name:"SHADE",frame:108,hp:1,speed:1.8,siege:9,reverse:3,attacked:function(){},dead:function(){}},BONE_SNAKE:{name:"BONE_SNAKE",frame:144,hp:2,speed:2.6,siege:1,reverse:1,attacked:function(){},dead:function(){}},GOLEM:{name:"GOLEM",frame:148,hp:7,speed:1,siege:1,reverse:6,attacked:function(){},dead:function(){}},SPECTOR:{name:"SPECTOR",frame:152,hp:1,speed:1.8,siege:0,reverse:3,attacked:function(){},dead:function(){}},ARACHNE:{name:"ARACHNE",frame:156,hp:3,speed:2,siege:1,
reverse:4,attacked:function(b){b=b.enemy;b.reverse=9;b.speed/=2},dead:function(){}}}},AI:{USER:[{direction:0,prop:"y",sign:-1,order:[1,3,0,2]},{direction:3,prop:"x",sign:-1,order:[0,2,3,1]},{direction:1,prop:"x",sign:1,order:[0,2,1,3]},{direction:2,prop:"y",sign:1,order:[3,1,2,0]}],ENEMY:[{direction:2,prop:"y",sign:1,order:[3,1,2,0]},{direction:3,prop:"x",sign:-1,order:[2,0,3,1]},{direction:1,prop:"x",sign:1,order:[2,0,1,3]},{direction:0,prop:"y",sign:1,order:[3,1,0,2]}]}}},THUMB:function(){return{IMAGE:"img/thumb.png",
CHIP_SIZE:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:1,KNIGHT:2,ARCHER:3,CLELIC:4,FIRE_MAGE:5,FROST_MAGE:6,WIZARD:7},UNDEAD:{BONE_DOG:8,BONE_SNAKE:9,BONE_WARRIER:10,BONE_ARCHER:11,GOLEM:12,ARACHNE:13,SHADE:14,SPECTOR:15}},USER:{POSITION:[[0,384],[48,384],[96,384],[144,384],[0,432],[48,432],[96,432],[144,432]]},ENEMY:{},PROP:{}}},SCORE:function(){return{POSITION:[20,7]}},COUNTDOWN:function(){return{POSITION:[200,7]}},STATUS_VIEWER:function(){return{IMAGE:"img/window_status.png",POSITION:[192,384],BG_SIZE:[128,
96]}},MAP:function(){return{IMAGE:"img/map.png",W:320,H:480,CHIP_SIZE:32}},CASTLE:function(){return{FRAME:[{NORMAL:8,BRAKE:9},{NORMAL:10,BRAKE:11},{NORMAL:12,BRAKE:13},{NORMAL:14,BRAKE:15}],PROP:{frame:0,brake:0,hp:2,mhp:2,unitX:0,unitY:0}}},EFFECT:function(){return{IMAGE:"img/effect.gif",FRAME:{EXPLOSION:{start:0,end:5,rate:3,loop:!1},FIRE:{start:6,end:8,rate:50,loop:!1},FROST:{start:11,end:11,rate:10,loop:!1}}}},SOUND:function(){return{BGM:"sound/bgm.wav",EFFECT:{EXPLOSION:"sound/explosion.wav"}}},
TYPE:function(){return{CASTLE:"CASTLE",THUMB:"THUMB",UNIT:"UNIT",EFFECT:"EFFECT"}},HAVE:function(){return{USER:"USER",ENEMY:"ENEMY"}},POINT:function(){return{UNIT:10,CASTLE:1E3,WIN:5E3,LOSE:-5E3,TIME:100}}}};CONST_CASH=J();CONST_CASH={TIMELIMIT:CONST_CASH.TIMELIMIT(),FONT:CONST_CASH.FONT(),UNIT:CONST_CASH.UNIT(),THUMB:CONST_CASH.THUMB(),SCORE:CONST_CASH.SCORE(),COUNTDOWN:CONST_CASH.COUNTDOWN(),STATUS_VIEWER:CONST_CASH.STATUS_VIEWER(),MAP:CONST_CASH.MAP(),CASTLE:CONST_CASH.CASTLE(),EFFECT:CONST_CASH.EFFECT(),
SOUND:CONST_CASH.SOUND(),TYPE:CONST_CASH.TYPE(),HAVE:CONST_CASH.HAVE(),POINT:CONST_CASH.POINT()};var U=function(){var b=CONST_CASH.THUMB,c=b.CHIP_SIZE,h=b.FRAME.HUMAN,e=b.FRAME.UNDEAD,d=new Scene,f=n.assets[b.IMAGE],a=n.assets[CONST_CASH.STATUS_VIEWER.IMAGE],i=new Group,j=new Sprite(c,c),g=new Label,k=new Label,l=new Sprite(250,100),s=new Group,c=new Sprite(c,c),m=new Label,t=new Label,o=new Sprite(250,100),G=function(a){var c,d,e,h,f=new Label,i=Q.USER,g=CONST_CASH.HAVE.USER,j=b.USER.POSITION,k=
b.FRAME;B=a.race;e=a.order;c=0;for(d=e.length;c<d;c++)a=e[c].toUpperCase(),h=j[c],i[c]=new T({mode:g,name:a,frame:k[B][a],x:h[0],y:h[1]});f.text="\u2462";f.font="150px/1.5 "+CONST_CASH.FONT;f.color="#fff";f.x=90;f.y=100;n.rootScene.addChild(f);N.init();n.popScene();aid=setTimeout(function(){f.text="\u2461";aid=setTimeout(function(){f.text="\u2460";aid=setTimeout(function(){D.vibrate(3);c=0;for(d=e.length;c<d;c++)i[c].init();q.init();F.init();H.init();n.rootScene.removeChild(f)},1E3)},1E3)},1E3)};
d.backgroundColor="rgba(0,0,0,0.3)";j.image=c.image=f;l.image=o.image=a;l.frame=o.frame=1;i.addChild(l);s.addChild(o);i.x=s.x=35;i.y=100;s.y=220;j.frame=h.KNIGHT;c.frame=e.BONE_WARRIER;j.x=c.x=5;j.y=c.y=5;g.font=k.font=m.font=t.font="12px/1.5 "+CONST_CASH.FONT;g.color=k.color=m.color=t.color="#ddd";g.text="<b>HUMAN</b>";m.text="<b>UNDEAD</b>";k.text="\u4f7f\u3044\u3084\u3059\u304f\u3001\u9ad8\u6027\u80fd\u306a\u7a2e\u65cf\u3002\u30d0\u30e9\u30f3\u30b9\u304c\u826f\u304f\u6271\u3044\u3084\u3059\u3044\u3002";
t.text="\u6271\u3044\u3065\u3089\u3044\u5c16\u3063\u305f\u6027\u80fd\u3092\u6301\u3064\u30e6\u30cb\u30c3\u30c8\u304c\u591a\u3044\u7a2e\u65cf\u3002<br />\u64cd\u4f5c\u91cf\u306b\u81ea\u4fe1\u304c\u3042\u308b\u4eba\u5411\u3051\u3002";g.x=m.x=50;g.y=m.y=5;k.width=t.width=200;k.x=t.x=50;k.y=t.y=23;i.addChild(j);i.addChild(g);i.addChild(k);s.addChild(c);s.addChild(m);s.addChild(t);d.addChild(i);d.addChild(s);i.addEventListener(enchant.Event.TOUCH_END,function(){G({race:"HUMAN",order:"LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")})});
s.addEventListener(enchant.Event.TOUCH_END,function(){G({race:"UNDEAD",order:"BONE_WARRIER,BONE_ARCHER,BONE_DOG,BONE_SNAKE,GOLEM,ARACHNE,SHADE,SPECTOR".split(",")})});n.pushScene(d)},$=function(){var b=CONST_CASH.MAP.CHIP_SIZE,c=O,h=new Map(b,b),e=n.assets[CONST_CASH.MAP.IMAGE],d=r.USER,f=r.ENEMY,a=CONST_CASH.CASTLE.FRAME,i=CONST_CASH.HAVE.USER,j=r.MAP_OPTION.CASTLE_BASE,g=r.MAP_OPTION.THUMB_BASE,k=r.EFFECT.UNIT,l=n.rootScene,s=CONST_CASH.UNIT.CHIP_SIZE,m=CONST_CASH.SCORE.POSITION,t,o=CONST_CASH.COUNTDOWN.POSITION,
G=CONST_CASH.STATUS_VIEWER.POSITION,K,E;P=document.getElementById("enchant-stage");h.image=e;h.loadData(c);h.vibrate=function(a){var b=P.style,a=a+"px";clearInterval(E);E=setTimeout(function(){b.top=0;b.left=a;E=setTimeout(function(){b.top=a;b.left=0;E=setTimeout(function(){b.top=0;b.left="-"+a;E=setTimeout(function(){b.top=0;b.left=0},30)},30)},30)},30)};h.getSquere=function(a){var c,d,e=Math.floor;h.getSquere=function(a){c=e(a.x/b);d=e(a.y/b);return{x:c,y:d}};return h.getSquere(a)};h.getCollision=
function(a){var b=h.getSquere(a),c=R,d=!1,e,f,i;if((c=c[b.y])&&(c=c[b.x]))if(1===c[0]+c[1]+c[2]+c[3])for(e in w){if(!0===w.hasOwnProperty(e)){f=w[e];b=0;for(c=f.length;b<c;b++)if(i=f[b],!0===a.intersect(i)){d=i;break}}}else d=c;return d};D=h;statusViewer=N=new V({mode:i,x:G[0],y:G[1]});c=M=new W({mode:i,x:m[0],y:m[1]});t=H=new X({x:o[0],y:o[1]});t.update();for(K in C)if(!0===C.hasOwnProperty(K)){i=C[K];o=0;for(e=i.length;o<e;o++)m=new Y({mode:K,frame:a[o].NORMAL,brake:a[o].BRAKE,x:i[o][0]*b,y:i[o][1]*
b}),m.unitX=m.x+s/2,m.unitY=m.y+s/2}l.addChild(h);l.addChild(j);l.addChild(statusViewer);l.addChild(g);l.addChild(f.CASTLE);l.addChild(f.UNIT);l.addChild(d.UNIT);l.addChild(d.CASTLE);l.addChild(d.THUMB);l.addChild(f.THUMB);l.addChild(k);l.addChild(c.label);l.addChild(t);S=n.assets[CONST_CASH.SOUND.EFFECT.EXPLOSION];z.init();(function(){var a=!1,b=function(){new Z(a);p.end();F.end();t.stop();n.end();q.end()};p.add(function(){return!0===gameStart?(new U,t.setAfter(function(){a=!0;b();return!0}),p.remove("playStart"),
!0):!1},"playStart");p.add(function(){var c,d,e,f,i,h;if(!1!==a)return b(),!0;for(c in w)if(!0===w.hasOwnProperty(c)){f=w[c];e=f.length;for(d=h=0;d<e&&!(i=f[d],0<i.hp);d++)h++;if(h===e){a=c;break}}return!1},"playEnd");p.init()})();return h},Y=function(b){var c=CONST_CASH.MAP.CHIP_SIZE,h=n.assets[CONST_CASH.MAP.IMAGE],e=J().CASTLE().PROP,d=b.mode.toUpperCase(),f=CONST_CASH.HAVE,a=new Sprite(c,c),i=r.MAP_OPTION.CASTLE_BASE,j=-1,g,c=new Sprite(c,c);c.image=h;c.frame=24;d===f.USER&&(c.frame=16);c.x=b.x;
c.y=b.y;v({layer:i,sprite:c});e.base=c;e=y(e,b);a.image=h;a=y(a,e);a.type=CONST_CASH.TYPE.CASTLE;w[d].push(a);a.focusOn=function(){a.scaleX=a.scaleY=1.4;a.focus=true};a.focusOff=function(){a.scaleX=a.scaleY=1;a.focus=false};g=function(){if(n.frame%2===0){a.opacity=a.opacity+0.1*j;a.opacity<=0.5?j=1:a.opacity>=1&&(j=-1)}};a.blinkOn=function(){a.addEventListener(enchant.Event.ENTER_FRAME,g)};a.blinkOff=function(){a.removeEventListener(enchant.Event.ENTER_FRAME,g);a.opacity=1};a.damage=function(b){a.hp=
a.hp-b.siege;if(a.hp<=0){a.hp=0;a.broke()}else if(a.mhp/2>=a.hp)a.frame=a.brake};a.broke=function(){a.hp=a.opacity=a.base.opacity=0};a.checkBreak=function(){return a.hp===0?true:false};return v({layer:r[d].CASTLE,sprite:a})},T=function(b){var c=CONST_CASH.THUMB.CHIP_SIZE,h=n.assets[CONST_CASH.THUMB.IMAGE],e=J().THUMB().PROP,d=CONST_CASH.UNIT.STATUS[B][b.name],f=b.mode.toUpperCase(),a=new Sprite(c,c),c=new Sprite(c,c),i,j,g,k,l=enchant.Event,s=N,m=new Label;c.image=h;c.frame=16;c.x=b.x;c.y=b.y;v({layer:r.MAP_OPTION.THUMB_BASE,
sprite:c});m.text=Math.ceil(d.reverse);m.font="24px "+CONST_CASH.FONT;m.color="#ccc";m.x=b.x+17;m.y=b.y+7;v({layer:r.MAP_OPTION.THUMB_BASE,sprite:m});e=y(e,b);a.image=h;a=y(a,e);a.unit={mode:f};a.unit=y(a.unit,d);a.type=CONST_CASH.TYPE.THUMB;g=a.x;k=a.y;a.addEventListener(l.TOUCH_START,function(b){!0===this.canDrag&&(i=b.x-this.x,j=b.y-this.y);s.update(a.unit)});a.addEventListener(l.TOUCH_MOVE,function(a){!0===this.canDrag&&(this.x=a.x-i,this.y=a.y-j)});a.addEventListener(l.TOUCH_END,function(){if(!0===
this.canDrag){var a;a=!1;var b=w.USER,c,d,e;d=0;for(e=b.length;d<e;d++)if(c=b[d],!0===this.intersect(c)){a=c;break}!1!==a&&(this.dragStop(),this.unit.x=a.unitX,this.unit.y=a.unitY,this.lastUnit=new L(this.unit),this.lastUnit.thumb=this);this.x=g;this.y=k}});a.dragStart=function(){a.canDrag=!0;a.opacity=1};a.dragStop=function(){a.canDrag=!1;a.opacity=0};a.reverse=function(b){var c=Math.ceil(b.reverse),d=setInterval(function(){c--;m.text=c;0===c&&(m.text="",a.dragStart(),clearInterval(d))},1E3);m.text=
c;a.opacity=0.3};Q[f].push(a);a.dragStop();a.opacity=0.3;a.init=function(){a.reverse(a.unit)};return v({layer:r[f].THUMB,sprite:a})},L=function(b){var c=CONST_CASH.UNIT.CHIP_SIZE,h=CONST_CASH.MAP.CHIP_SIZE,e=c/2,d=n.assets[CONST_CASH.UNIT.IMAGE],f=b.mode.toUpperCase(),a=new Sprite(c,c),i=new Label,c=CONST_CASH.HAVE,j=CONST_CASH.UNIT.FRAME_LINE,g=0,k=0,l=CONST_CASH.UNIT.AI[f],s,m,t,o,p;a.direction=0;a.image=d;a=y(a,b);a.hplabel=i;i.x=b.x-2;i.y=b.y-14;i.font="9px "+CONST_CASH.FONT;i.color="#FAA";i.backgroundColor=
"rgba(0,0,0,0.5)";i.width=20;i.update=function(){i.text="\u2020"+a.hp};i.update();v({layer:r[f].UNIT,sprite:i});a.type=CONST_CASH.TYPE.UNIT;a.attack=function(b,c){b.hp-=c;a.attacked({mine:a,enemy:b});b.hplabel.update();0>=b.hp&&(b.dead({mine:a,enemy:b}),b.kill());return b.hp};a.kill=function(){var b=a.x,c=a.y;new I({type:a.type.toUpperCase(),x:b,y:c,frames:CONST_CASH.EFFECT.FRAME.EXPLOSION});S.play();delete x[f][a.myNo];r[f].UNIT.removeChild(a);r[f].UNIT.removeChild(i);"function"===typeof a.after_death&&
setTimeout(function(){a.after_death(a)},1E3*a.reverse);void 0!==a.thumb&&a.thumb.reverse(a)};a.checkDeath=function(){return 0===a.hp?!0:!1};s=a.frame;a.changeUnit=function(a){s=a.frame};m=function(){return D.getSquere(a)};a.beforePoint=m();t=function(){var b=!1;if(e>=h){var c,d=a.beforePoint;e-=h;if(0<e){switch(a.direction){case 0:a.y+=e;break;case 1:a.x-=e;break;case 2:a.y-=e;break;case 3:a.x+=e}a.y=Math.round(a.y);a.x=Math.round(a.x)}e=0;c=m();if(c.x!==d.x||c.y!==d.y)b=!0}return b};o=function(){return D.getCollision(a)};
p=function(){var b=a.direction,c=a.speed,d=CONST_CASH.TYPE,f,h=l.length,g,j;p=function(){if(0===n.frame%3){e+=c;for(f=0;f<h;f++)if(g=l[f],b===g.direction){a[g.prop]+=c*g.sign;i[g.prop]+=c*g.sign;!0===t()&&(j=o(),!1!==j&&(j.type!==d.CASTLE?a.direction=1===j[g.order[0]]?g.order[0]:1===j[g.order[1]]?g.order[1]:1===j[g.order[2]]?g.order[2]:g.order[3]:z.siege(a,j)));break}}};p()};a.addEventListener(enchant.Event.ENTER_FRAME,p);a.addEventListener(enchant.Event.ENTER_FRAME,function(){if(0===n.frame%5){g++;
switch(g){case 4:g=0;k=-1;break;case 3:k=0}k++}a.frame=s+k*j+a.direction});a.stay=function(){r[f].UNIT.removeChild(i);a.removeEventListener(enchant.Event.ENTER_FRAME,p)};a.myNo=x.no;x[f][x.no]=a;x.no++;f===c.USER&&(e=-e,i.color="#AAF");q.unit(a);return v({layer:r[f].UNIT,sprite:a})},W=function(b){var c=CONST_CASH.HAVE,h=b.mode,e=b.x,b=b.y,d=new Label,f={},a=function(a){f.total+=a;return f.total};d.font="12px "+CONST_CASH.FONT;d.color="#ccc";d.x=e;d.y=b;f={label:d,total:0,rate:0.5,mode:h,point:J().POINT,
add:a,update:function(){}};h===c.USER&&(f.update=function(){d.text="SCORE : "+f.total},f.get=function(){return f.total},f.add=function(b){a(b);f.update();return f.total},f.rate=1);f.update();return f},X=function(b){var c=new Label,h=CONST_CASH.TIMELIMIT,e=0,d,f=function(){};c.font="12px "+CONST_CASH.FONT;c.color="#ccc";c.x=b.x;c.y=b.y;c.update=function(){c.text="TIME-LIMIT : "+(h-e)};c.init=function(){c.stop();d=setInterval(function(){e++;e>=h&&(f(),c.stop());c.update()},1E3)};c.setAfter=function(a){f=
a};c.getDiff=function(){return h-e};c.stop=function(){clearInterval(d)};return c},I=function(b){var c=CONST_CASH.UNIT.CHIP_SIZE,h=b.frames,e=h.start,d=h.end,f=h.rate,h=h.loop,a=b.type.toUpperCase(),i=r.EFFECT[a],j=new Sprite(c,c),g;g=!0===h?function(){0===n.frame%f&&(j.frame>=d?j.frame=e:j.frame++)}:function(){0===n.frame%f&&(j.frame++,j.frame>=d&&j.end())};j.image=n.assets[CONST_CASH.EFFECT.IMAGE];j.x=b.x;j.y=b.y;j.frame=e;j.addEventListener(enchant.Event.ENTER_FRAME,g);j.end=function(){j.removeEventListener(enchant.Event.ENTER_FRAME,
g);i.removeChild(j)};return v({layer:i,sprite:j})},F={aiid:0,race:"",order:[],init:function(){var b=F,c=CONST_CASH.HAVE.ENEMY,h,e,d,f=w.ENEMY,a=f.length,i=CONST_CASH.UNIT.STATUS,j,g,k;switch(B){case "HUMAN":b.race="UNDEAD";b.order="BONE_DOG,BONE_WARRIER,BONE_ARCHER,SHADE,BONE_SNAKE,GOLEM,SPECTOR,ARACHNE".split(",");break;case "UNDEAD":b.race="HUMAN",b.order="LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")}i=i[b.race];j=b.order;b.aiid=setInterval(function(){g=j.length;0<
g&&(d=Math.floor(Math.random()*a),d>=a&&(d=a-1),h=f[d],d=Math.floor(Math.random()*g),d>=g&&(d=g-1),k=j[d],e=i[k],j.splice(d,1),d={mode:c,direction:2,x:h.unitX,y:h.unitY,after_death:function(a){j.push(a.name)}},d=y(d,e),e=new L(d))},6E3)},end:function(){clearInterval(F.aiid)}},z={init:function(){p.add(function(){var b=x.USER,c=x.ENEMY,h,e,d,f;for(d in c)if(!0===c.hasOwnProperty(d))for(f in e=c[d],b)!0===b.hasOwnProperty(f)&&(h=b[f],!0===e.intersect(h)&&(h.x===e.x||h.y===e.y)&&z.unitAndUnit(e,h))},
"battle")},score:function(b){var c=CONST_CASH.HAVE,h=b.mode,e=CONST_CASH.TYPE,b=b.type,d=M,f=CONST_CASH.POINT;b!==e.CASTLE&&h===c.USER||b===e.CASTLE&&h===c.ENEMY?d.add(f[b]):b===e.CASTLE&&h===c.USER&&d.add(-f[b])},unitAndUnit:function(b,c){for(var h=b.hp,e=c.hp,d=h,f=e;0<h&&0<e;)h=b.attack(c,d),e=c.attack(b,f);!0===b.checkDeath()&&(q.death(b),z.score(b));!0===c.checkDeath()&&(q.death(c),z.score(c))},siege:function(b,c){q.siege(c);c.damage(b);b.kill();D.vibrate(3);!0===c.checkBreak()&&(q.castle(c),
z.score(c))}},p={functions:{},exefunc:function(){var b,c=p.functions;for(b in c)if(!0===c.hasOwnProperty(b))c[b]()},add:function(b,c){p.functions[c]=b},remove:function(b){delete p.functions[b]},init:function(){n.addEventListener(enchant.Event.ENTER_FRAME,p.exefunc,!1)},stop:function(){n.removeEventListener(enchant.Event.ENTER_FRAME,p.exefunc,!1)},end:function(){p.functions={};p.stop()}},V=function(){var b=new Label,c=new Group,h,e=CONST_CASH.STATUS_VIEWER,d=e.POSITION,f=n.assets[e.IMAGE],e=e.BG_SIZE,
a=new Sprite(e[0],e[1]),i=CONST_CASH.UNIT.STATUS,e=CONST_CASH.HAVE.USER,j={};c.x=d[0];c.y=d[1];a.image=f;a.frame=0;a.opacity=0;b.font="9px/1.5 "+CONST_CASH.FONT;b.color="#fff";b.text="";b.x=45;b.y=8;h=new L({mode:e,x:15,y:15,opacity:0});h.frame=0;h.direction=2;h.stay();c.update=function(a){h.opacity=1;c.update=function(a){b.text=j[a.name];h.changeUnit(a)};c.update(a)};c.init=function(){var b,c,d=i[B];for(b in d)!0===d.hasOwnProperty(b)&&(c=d[b],j[b]="<b>"+c.name+"</b><br />\u2020: "+c.hp+"<br />\u21d2: "+
c.speed+"/frame<br />\u00d7: "+c.reverse+"sec");a.opacity=1};c.addChild(a);c.addChild(b);c.addChild(h);return c},q={logid:0,data:{time:0,victory:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}},unit:function(b){q.data.unit[b.mode]++},death:function(b){q.data.death[b.mode]++},siege:function(b){q.data.siege[b.mode]++},castle:function(b){q.data.castle[b.mode]++},send:function(){q.data.time=H.getDiff()},reset:function(){q.data={time:0,unit:{USER:0,ENEMY:0},
death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}}},init:function(){q.reset()},end:function(){q.send();clearInterval(q.logid)}},Z=function(b){var c=new Scene,h=new Label,e=new Label,d=CONST_CASH.HAVE,f=M.get(),a=CONST_CASH.POINT,i;i="SCORE: "+f+"<br>";switch(b){case d.ENEMY:b="WIN";q.data.victory=1;d=H.getDiff()*a.TIME;i+="&nbsp;WIN: "+a.WIN+"<br>&nbsp;CLEAR TIME BONUS: "+d;f+=a.WIN+d;break;case d.USER:b="LOSE";q.data.victory=-1;i+="&nbsp;LOSE: "+a.LOSE;f+=a.LOSE;break;default:b=
"DRAW",i+="&nbsp;DRAW: 0"}a=CONST_CASH.FONT;h.font="20px/1.5 "+a;h.color="#fff";h.text="RESULT";h.x=100;h.y=100;e.font="12px/1.5 "+a;e.color="#fff";e.text=i+("<br><br><b>TOTAL: "+f+"</b>");e.x=100;e.y=150;c.addChild(h);c.addChild(e);c.backgroundColor="rgba(0,0,0,0.3)";n.pushScene(c);n.end(f,b+":"+f)};return PUBLIC={GAME:n,Amida:$,Battle:z,Castle:Y,CONST:CONST_CASH,Countdown:X,Effect:I,EnemyAction:F,init:function(b){var c=CONST_CASH.UNIT.IMAGE,h=CONST_CASH.THUMB.IMAGE,e=CONST_CASH.MAP.IMAGE,d=CONST_CASH.EFFECT.IMAGE,
f=CONST_CASH.STATUS_VIEWER.IMAGE,a=CONST_CASH.SOUND.EFFECT.EXPLOSION,i=CONST_CASH.MAP.W,j=CONST_CASH.MAP.H,g,k;O=b=b.map;g=0;for(k=b.length;g<k;g++)b[g]=b[g].split("");g={"0":0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,24:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,25:[0,0,1,0],99:[1,0,0,0],16:[1,0,1,0],17:[0,1,0,1],18:[1,1,1,0],19:[1,0,1,1],20:[0,1,1,0],21:[0,0,1,1],22:[1,1,0,0],23:[1,0,0,1]};var l,p,m,q,o,r=[],b=[].concat([[26,
27,28,29,30,31,32,33,34,35],[0,1,1,1,1,1,1,1,1,2]],b,[[5,6,6,6,6,6,6,6,6,7],[36,37,38,39,40,41,42,43,44,45],[46,47,48,49,50,51,52,46,47,48],[49,50,51,52,51,52,46,47,48,49]]);k=0;for(p=b.length;k<p;k++){q=r[k]=[];o=b[k];8===o.length&&(b[k]=o=["3"].concat(o,"4"));l=0;for(m=o.length;l<m;l++){var v=o,w=l,u=o[l];switch(u){case "\u2502":u=16;break;case "\u2500":u=17;break;case "\u251c":u=18;break;case "\u2524":u=19;break;case "\u250c":u=20;break;case "\u2510":u=21;break;case "\u2514":u=22;break;case "\u2518":u=
23;break;case "\u00d7":u=24;break;case "\u25a0":u=25;break;case "\u25a1":u=99}v[w]=u;q[l]=g[o[l]];switch(o[l]){case 25:C.ENEMY.push([l,k]);break;case 99:C.USER.push([l,k]),o[l]=25}}}O=b;R=r;n=new Game(i,j);n.preload(c,h,e,d,f,a);n.onload=$;n.start()},Log:q,RaceSelect:U,RandamMap:function(){var b=["\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),
"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1".split(",")],c=b.length-2,h=b[0].length-2,e=[],d,f,a,i,j,g,k;a=Math.floor;var l=Math.random;for(d=0;4>
d;d++){i=2*d;j=a(l()*c)+1;for(f=1;f<=c;f++)g=b[f],f===j?(g[i]="\u2514",g[i+1]="\u2510",i+=1):g[i]="\u2502"}for(d=0;d<h;d++)for(f=1;f<=c;f++)g=b[f],j=g[d],"\u2502"===j&&(j=g[d+1],i=g[d+2],k=g[d+3],("\u2502"===j||"\u00d7"===j&&"\u2502"===i||7>=d+3&&"\u00d7"===j&&"\u00d7"===i&&"\u2502"===k)&&e.push({x:d,y:f}));c=e.length-1;for(d=0;100>d;d++)j=a(l()*c)+1,g=e[0],e[0]=e[j],e[j]=g;for(d=0;d<e.length&&3>d;d++)g=e[d],a=g.x,i=g.y,g=b[i],j=a+1,i=a+2,k=a+3,"\u2502"===g[a]&&"\u2502"===g[j]?(g[a]="\u251c",g[j]=
"\u2524"):"\u2502"===g[a]&&"\u00d7"===g[j]&&"\u2502"===g[i]?(g[a]="\u251c",g[j]="\u2500",g[i]="\u2524"):"\u2502"===g[a]&&"\u00d7"===g[j]&&"\u00d7"===g[i]&&"\u2502"===g[k]?(g[a]="\u251c",g[j]="\u2500",g[i]="\u2500",g[k]="\u2524"):(e.splice(d,1),d--);d=0;for(c=b.length;d<c;d++)b[d]=b[d].join("");return b},Result:Z,Score:W,StatusViwer:V,Surveillant:p,Thumb:T,Unit:L}}(window);AW.init({map:"\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7,\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502\u00d7,\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524\u00d7,\u2502\u00d7\u2514\u2510\u2502\u00d7\u2502\u00d7,\u2514\u2510\u00d7\u251c\u2524\u00d7\u2514\u2510,\u00d7\u2502\u00d7\u2502\u2514\u2510\u00d7\u2502,\u00d7\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502,\u00d7\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524,\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1".split(",")});
