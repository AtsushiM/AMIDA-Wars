enchant();
var AW=function(C){var S=function(){C.pageYOffset===0&&C.scrollTo(0,1)};C.onorientationchange=function(){setTimeout(S,100)};C.addEventListener("load",C.onorientationchange,false);var q,N,v={USER:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},ENEMY:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},MAP_OPTION:{CASTLE_BASE:new Group,THUMB_BASE:new Group},EFFECT:{UNIT:new Group}},D="",O=[],x={USER:{},ENEMY:{},no:0},P={USER:[],ENEMY:[]},t={USER:[],ENEMY:[]},K={},G={},L={},M=[],E={USER:[],ENEMY:[]},
Q=[],F={},y=function(b,c){b===void 0&&(b={});for(var d in c)c.hasOwnProperty(d)===true&&(b[d]=c[d]);return b},z=function(b){b.layer.addChild(b.sprite);return b.sprite},R={},H=function(){return{TIMELIMIT:function(){return 180},FONT:function(){return"monospace"},UNIT:function(){return{IMAGE:"char.gif",CHIP_SIZE:16,FRAME_SIZE:{W:4,H:3},FRAME_LINE:16,FRAME_BLOCK:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:4,KNIGHT:8,ARCHER:12,CLELIC:16,FIRE_MAGE:20,FROST_MAGE:24,WIZARD:28},UNDEAD:{BONE_DOG:32,BONE_WARRIER:36,BONE_ARCHER:40,
SPECTOR:44,BONE_SNAKE:48,GOLEM:52,SHADE:56,ARACHNE:60}},STATUS:{HUMAN:{WARRIOR:{name:"WARRIOR",frame:0,hp:2,armor:"MIDIUM",speed:1,damage:3,siege:1,reverse:4},LANCER:{name:"LANCER",frame:4,hp:3,armor:"MIDIUM",speed:1,damage:2,siege:1,reverse:2},KNIGHT:{name:"KNIGHT",frame:8,hp:4,armor:"HEAVY",speed:0.9,damage:2,siege:1,reverse:7},ARCHER:{name:"ARCHER",frame:12,hp:1,armor:"LIGHT",speed:1.1,damage:3,siege:1,reverse:3},CLELIC:{name:"CLELIC",frame:48,hp:1,armor:"NOARMOR",speed:0.5,damage:1,siege:1,reverse:2},
FIRE_MAGE:{name:"FIRE_MAGE",frame:52,hp:1,armor:"NOARMOR",speed:0.8,damage:2,siege:1,reverse:3},FROST_MAGE:{name:"FROST_MAGE",frame:56,hp:1,armor:"NOARMOR",speed:0.8,damage:2,siege:1,reverse:3},WIZARD:{name:"WIZARD",frame:60,hp:1,armor:"NOARMOR",speed:0.8,damage:3,siege:1,reverse:4}},UNDEAD:{BONE_DOG:{name:"BONE_DOG",frame:96,hp:1,armor:"LIGHT",speed:1.4,damage:2,siege:1,reverse:1},BONE_WARRIER:{name:"BONE_WARRIER",frame:100,hp:2,armor:"MIDIUM",speed:1,damage:2,siege:1,reverse:1},BONE_ARCHER:{name:"BONE_ARCHER",
frame:104,hp:1,armor:"MIDIUM",speed:1,damage:3,siege:1,reverse:1},SHADE:{name:"SHADE",frame:108,hp:1,armor:"NOARMOR",speed:0.7,damage:1,siege:1,reverse:3},BONE_SNAKE:{name:"BONE_SNAKE",frame:144,hp:2,armor:"LIGHT",speed:1.3,damage:1,siege:1,reverse:1},GOLEM:{name:"GOLEM",frame:148,hp:5,armor:"HEAVY",speed:0.5,damage:2,siege:10,reverse:6},SPECTOR:{name:"SPECTOR",frame:152,hp:1,armor:"NOARMOR",speed:0.7,damage:1,siege:1,reverse:3},ARACHNE:{name:"ARACHNE",frame:156,hp:3,armor:"MIDIUM",speed:1,damage:2,
siege:1,reverse:4}}},AI:{USER:[{direction:0,prop:"y",sign:-1,order:[1,3,0,2]},{direction:3,prop:"x",sign:-1,order:[0,2,3,1]},{direction:1,prop:"x",sign:1,order:[0,2,1,3]},{direction:2,prop:"y",sign:1,order:[3,1,2,0]}],ENEMY:[{direction:2,prop:"y",sign:1,order:[3,1,2,0]},{direction:3,prop:"x",sign:-1,order:[2,0,3,1]},{direction:1,prop:"x",sign:1,order:[2,0,1,3]},{direction:0,prop:"y",sign:1,order:[3,1,0,2]}]}}},THUMB:function(){return{IMAGE:"thumb.png",CHIP_SIZE:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:1,
KNIGHT:2,ARCHER:3,CLELIC:4,FIRE_MAGE:5,FROST_MAGE:6,WIZARD:7},UNDEAD:{BONE_DOG:8,BONE_SNAKE:9,BONE_WARRIER:10,BONE_ARCHER:11,GOLEM:12,ARACHNE:13,SHADE:14,SPECTOR:15}},USER:{POSITION:[[0,384],[48,384],[96,384],[144,384],[0,432],[48,432],[96,432],[144,432]]},ENEMY:{},PROP:{}}},SCORE:function(){return{POSITION:[20,7]}},COUNTDOWN:function(){return{POSITION:[200,7]}},STATUS_VIEWER:function(){return{IMAGE:"window_status.png",POSITION:[192,384],BG_SIZE:[128,96]}},MAP:function(){return{IMAGE:"map.png",W:320,
H:480,CHIP_SIZE:32}},CASTLE:function(){return{FRAME:[{NORMAL:8,BRAKE:9},{NORMAL:10,BRAKE:11},{NORMAL:12,BRAKE:13},{NORMAL:14,BRAKE:15}],PROP:{frame:0,brake:0,hp:2,mhp:2,unitX:0,unitY:0}}},EFFECT:function(){return{IMAGE:"effect.gif",FRAME:{EXPLOSION:[0,5]}}},SOUND:function(){return{BGM:"bgm.wav",EFFECT:{EXPLOSION:"explosion.wav"}}},TYPE:function(){return{CASTLE:"CASTLE",THUMB:"THUMB",UNIT:"UNIT",EFFECT:"EFFECT"}},HAVE:function(){return{USER:"USER",ENEMY:"ENEMY"}},POINT:function(){return{UNIT:10,CASTLE:1E3,
WIN:5E3,LOSE:-5E3,TIME:100}}}},d=H(),d={TIMELIMIT:d.TIMELIMIT(),FONT:d.FONT(),UNIT:d.UNIT(),THUMB:d.THUMB(),SCORE:d.SCORE(),COUNTDOWN:d.COUNTDOWN(),STATUS_VIEWER:d.STATUS_VIEWER(),MAP:d.MAP(),CASTLE:d.CASTLE(),EFFECT:d.EFFECT(),SOUND:d.SOUND(),TYPE:d.TYPE(),HAVE:d.HAVE(),POINT:d.POINT()};R.init=function(b){var c=d.UNIT.IMAGE,h=d.THUMB.IMAGE,e=d.MAP.IMAGE,f=d.EFFECT.IMAGE,g=d.STATUS_VIEWER.IMAGE,a=d.MAP.W,j=d.MAP.H,k,i;M=b=b.map;for(k=0,i=b.length;k<i;k++)b[k]=b[k].split("");k={0:0,1:0,2:0,3:0,4:0,
5:0,6:0,7:0,24:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,48:0,49:0,50:0,51:0,52:0,25:[0,0,1,0],99:[1,0,0,0],16:[1,0,1,0],17:[0,1,0,1],18:[1,1,1,0],19:[1,0,1,1],20:[0,1,1,0],21:[0,0,1,1],22:[1,1,0,0],23:[1,0,0,1]};var n,l,o,m,p,r=[],b=[].concat([[26,27,28,29,30,31,32,33,34,35],[0,1,1,1,1,1,1,1,1,2]],b,[[5,6,6,6,6,6,6,6,6,7],[36,37,38,39,40,41,42,43,44,45],[46,47,48,49,50,51,52,46,47,48],[49,50,51,52,51,52,46,47,48,49]]);for(i=0,
l=b.length;i<l;i++){m=r[i]=[];p=b[i];p.length===8&&(b[i]=p=["3"].concat(p,"4"));for(n=0,o=p.length;n<o;n++){var I=p,A=n,s=p[n];switch(s){case "\u2502":s=16;break;case "\u2500":s=17;break;case "\u251c":s=18;break;case "\u2524":s=19;break;case "\u250c":s=20;break;case "\u2510":s=21;break;case "\u2514":s=22;break;case "\u2518":s=23;break;case "\u00d7":s=24;break;case "\u25a0":s=25;break;case "\u25a1":s=99}I[A]=s;m[n]=k[p[n]];switch(p[n]){case 25:E.ENEMY.push([n,i]);break;case 99:E.USER.push([n,i]),p[n]=
25}}}M=b;Q=r;q=new Game(a,j);q.preload(c,h,e,f,g);q.onload=Amida;q.start()};RaceSelect=function(){var b=d.THUMB,c=b.CHIP_SIZE,h=b.FRAME.HUMAN,e=b.FRAME.UNDEAD,f=new Scene,b=q.assets[b.IMAGE],g=q.assets[d.STATUS_VIEWER.IMAGE],a=new Group,j=new Sprite(c,c),k=new Label,i=new Label,n=new Sprite(250,100),l=new Group,c=new Sprite(c,c),w=new Label,m=new Label,p=new Sprite(250,100),r=function(a){var b,c,e,h=P.USER,f=d.HAVE.USER,g=d.THUMB.USER.POSITION;D=a.race;e=a.order;for(a=0,b=e.length;a<b;a++)O[a]={name:e[a].toUpperCase(),
onMap:false},c=O[a].name,h[a]=new Thumb({mode:f,name:c,frame:d.THUMB.FRAME[D][c],x:g[a][0],y:g[a][1]}),h[a].init();o.init();J.init();G.init();L.init();q.popScene()};f.backgroundColor="rgba(0,0,0,0.3)";j.image=c.image=b;n.image=p.image=g;n.frame=p.frame=1;a.addChild(n);l.addChild(p);a.x=l.x=35;a.y=100;l.y=220;j.frame=h.KNIGHT;c.frame=e.BONE_WARRIER;j.x=c.x=5;j.y=c.y=5;k.font=i.font=w.font=m.font="12px/1.5 "+d.FONT;k.color=i.color=w.color=m.color="#ddd";k.text="<b>HUMAN</b>";w.text="<b>UNDEAD</b>";
i.text="\u4f7f\u3044\u3084\u3059\u304f\u3001\u9ad8\u6027\u80fd\u306a\u7a2e\u65cf\u3002\u5c11\u6570\u7cbe\u92ed\u306e\u6df7\u6210\u90e8\u968a\u3002<br />\u30d0\u30e9\u30f3\u30b9\u306e\u826f\u3044\u9678\u6226\u968a\u3068\u52b9\u679c\u306e\u5f37\u529b\u306a\u9b54\u8853\u5e2b\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u6575\u3092\u846c\u308b\u3002";m.text="\u6271\u3044\u3065\u3089\u3044\u5c16\u3063\u305f\u6027\u80fd\u3092\u6301\u3064\u30e6\u30cb\u30c3\u30c8\u304c\u591a\u3044\u7a2e\u65cf\u3002<br />\u64cd\u4f5c\u91cf\u306b\u81ea\u4fe1\u304c\u3042\u308b\u306a\u3089\u3070\u9014\u5207\u308c\u308b\u3053\u3068\u7121\u304f\u653b\u3081\u7d9a\u3051\u3089\u308c\u308b\u3002";
k.x=w.x=50;k.y=w.y=5;i.width=m.width=200;i.x=m.x=50;i.y=m.y=23;a.addChild(j);a.addChild(k);a.addChild(i);l.addChild(c);l.addChild(w);l.addChild(m);f.addChild(a);f.addChild(l);a.addEventListener(enchant.Event.TOUCH_END,function(){r({race:"HUMAN",order:"LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")})});l.addEventListener(enchant.Event.TOUCH_END,function(){r({race:"UNDEAD",order:"BONE_WARRIER,BONE_ARCHER,BONE_DOG,BONE_SNAKE,GOLEM,ARACHNE,SHADE,SPECTOR".split(",")})});q.pushScene(f)};
Amida=function(){var b=d.MAP.CHIP_SIZE,c=M,h=new Map(b,b),e=q.assets[d.MAP.IMAGE],f=v.USER,g=v.ENEMY,a=d.CASTLE.FRAME,j=d.HAVE.USER,k=v.MAP_OPTION.CASTLE_BASE,i=v.MAP_OPTION.THUMB_BASE,n=v.EFFECT.UNIT,l=q.rootScene,w=d.UNIT.CHIP_SIZE,m=d.SCORE.POSITION,p,r=d.COUNTDOWN.POSITION,I=d.STATUS_VIEWER.POSITION,A,s;N=document.getElementById("enchant-stage");h.image=e;h.loadData(c);h.vibrate=function(a){var b=N.style;a+="px";clearInterval(s);s=setTimeout(function(){b.top=0;b.left=a;s=setTimeout(function(){b.top=
a;b.left=0;s=setTimeout(function(){b.top=0;b.left="-"+a;s=setTimeout(function(){b.top=0;b.left=0},30)},30)},30)},30)};h.getSquere=function(a){var c,d,e=Math.floor;h.getSquere=function(a){c=e(a.x/b);d=e(a.y/b);return{x:c,y:d}};return h.getSquere(a)};h.getCollision=function(a){var b=h.getSquere(a),c=Q,d=false,e,f,g;if((c=c[b.y])&&(c=c[b.x]))if(c[0]+c[1]+c[2]+c[3]===1)for(e in t){if(t.hasOwnProperty(e)===true){f=t[e];for(b=0,c=f.length;b<c;b++)if(g=f[b],a.intersect(g)===true){d=g;break}}}else d=c;return d};
F=h;statusViewer=L=new StatusViwer({mode:j,x:I[0],y:I[1]});c=K=new Score({mode:j,x:m[0],y:m[1]});p=G=new Countdown({x:r[0],y:r[1]});p.update();for(A in E)if(E.hasOwnProperty(A)===true){j=E[A];for(r=0,e=j.length;r<e;r++)m=new Castle({mode:A,frame:a[r].NORMAL,brake:a[r].BRAKE,x:j[r][0]*b,y:j[r][1]*b}),m.unitX=m.x+w/2,m.unitY=m.y+w/2}l.addChild(h);l.addChild(k);l.addChild(statusViewer);l.addChild(i);l.addChild(g.CASTLE);l.addChild(g.UNIT);l.addChild(f.UNIT);l.addChild(f.CASTLE);l.addChild(f.THUMB);l.addChild(g.THUMB);
l.addChild(n);l.addChild(c.label);l.addChild(p);B.init();(function(){var a=false,b=function(){new Result(a);u.end();J.end();o.end();p.stop()};u.add(function(){return gameStart===true?(new RaceSelect,p.setAfter(function(){a=true;b();return true}),u.remove("playStart"),true):false},"playStart");u.add(function(){var c,d,e,h,f,g;if(a!==false)return b(),true;for(c in t)if(t.hasOwnProperty(c)===true){h=t[c];e=h.length;for(d=g=0;d<e;d++)if(f=h[d],f.hp>0)break;else g++;if(g===e){a=c;break}}return false},
"playEnd");u.init()})()};Castle=function(b){var c=d.MAP.CHIP_SIZE,h=q.assets[d.MAP.IMAGE],e=H().CASTLE().PROP,f=b.mode.toUpperCase(),g=d.HAVE,a=new Sprite(c,c),j=v.MAP_OPTION.CASTLE_BASE,k=-1,i,c=new Sprite(c,c);c.image=h;c.frame=24;if(f===g.USER)c.frame=16;c.x=b.x;c.y=b.y;z({layer:j,sprite:c});e.base=c;e=y(e,b);a.image=h;a=y(a,e);a.type=d.TYPE.CASTLE;t[f].push(a);a.focusOn=function(){a.scaleX=a.scaleY=1.4;a.focus=true};a.focusOff=function(){a.scaleX=a.scaleY=1;a.focus=false};i=function(){q.frame%
2===0&&(a.opacity+=0.1*k,a.opacity<=0.5?k=1:a.opacity>=1&&(k=-1))};a.blinkOn=function(){a.addEventListener(enchant.Event.ENTER_FRAME,i)};a.blinkOff=function(){a.removeEventListener(enchant.Event.ENTER_FRAME,i);a.opacity=1};a.damage=function(b){a.hp-=b.siege;if(a.hp<=0)a.hp=0,a.broke();else if(a.mhp/2>=a.hp)a.frame=a.brake};a.broke=function(){a.hp=a.opacity=a.base.opacity=0};a.checkBreak=function(){return a.hp===0?true:false};return z({layer:v[f].CASTLE,sprite:a})};Thumb=function(b){var c=d.THUMB.CHIP_SIZE,
h=q.assets[d.THUMB.IMAGE],e=H().THUMB().PROP,f=d.UNIT.STATUS[D][b.name],g=b.mode.toUpperCase(),a=new Sprite(c,c),c=new Sprite(c,c),j,k,i,n,l=enchant.Event,o=L,m=new Label;c.image=h;c.frame=16;c.x=b.x;c.y=b.y;z({layer:v.MAP_OPTION.THUMB_BASE,sprite:c});m.text=Math.ceil(f.reverse);m.font="24px "+d.FONT;m.color="#ccc";m.x=b.x+17;m.y=b.y+7;z({layer:v.MAP_OPTION.THUMB_BASE,sprite:m});e=y(e,b);a.image=h;a=y(a,e);a.unit={mode:g};a.unit=y(a.unit,f);a.type=d.TYPE.THUMB;i=a.x;n=a.y;a.addEventListener(l.TOUCH_START,
function(b){if(this.canDrag===true){j=b.x-this.x;k=b.y-this.y;var b=t.USER,c,d,e;for(d=0,e=b.length;d<e;d++)c=b[d],c.checkBreak()===false&&c.blinkOn()}o.update(a.unit)});a.addEventListener(l.TOUCH_MOVE,function(a){if(this.canDrag===true){this.x=a.x-j;this.y=a.y-k;var a=t.USER,b,c,d,e=true;for(c=0,d=a.length;c<d;c++)b=a[c],e===true&&this.intersect(b)===true?(b.focusOn(),e=false):b.focusOff()}});a.addEventListener(l.TOUCH_END,function(){if(this.canDrag===true){var a;a=false;var b=t.USER,c,d,e;for(d=
0,e=b.length;d<e;d++)if(c=b[d],this.intersect(c)===true){a=c;break}if(a!==false)this.dragStop(),this.unit.x=a.unitX,this.unit.y=a.unitY,this.lastUnit=new Unit(this.unit),this.lastUnit.thumb=this,a.focusOff();this.x=i;this.y=n;a=t.USER;for(c=0,d=a.length;c<d;c++)b=a[c],b.checkBreak()===false&&b.blinkOff()}});a.dragStart=function(){a.canDrag=true;a.opacity=1};a.dragStop=function(){a.canDrag=false;a.opacity=0};a.reverse=function(b){var c=Math.ceil(b.reverse),d=setInterval(function(){c--;m.text=c;if(c===
0)m.text="",a.dragStart(),clearInterval(d)},1E3);m.text=c;a.opacity=0.3};P[g].push(a);a.dragStop();a.opacity=0.3;a.init=function(){a.reverse(a.unit)};return z({layer:v[g].THUMB,sprite:a})};Unit=function(b){var c=d.UNIT.CHIP_SIZE,h=d.MAP.CHIP_SIZE,e=c/2,f=q.assets[d.UNIT.IMAGE],g=b.mode.toUpperCase(),a=new Sprite(c,c),c=d.HAVE,j=d.UNIT.FRAME_LINE,k=0,i=0,n=d.UNIT.AI[g],l,u,m,p,r,t;a.direction=0;a.image=f;a=y(a,b);a.type=d.TYPE.UNIT;a.attack=function(b){b.hp-=a.damage;b.hp<=0&&b.kill();return b.hp};
a.kill=function(){var b=a.x,c=a.y;new Effect({type:a.type.toUpperCase(),x:b,y:c,frames:d.EFFECT.FRAME.EXPLOSION});delete x[g][a.myNo];v[g].UNIT.removeChild(a);typeof a.after_death==="function"&&setTimeout(function(){a.after_death(a)},a.reverse);a.thumb!==void 0&&a.thumb.reverse(a)};a.checkDeath=function(){return a.hp===0?true:false};l=a.frame;a.changeUnit=function(a){l=a.frame};u=function(){return F.getSquere(a)};a.beforePoint=u();m=function(){var b=false;if(e>=h){var c,d=a.beforePoint;e-=h;if(e>
0){switch(a.direction){case 0:a.y+=e;break;case 1:a.x-=e;break;case 2:a.y-=e;break;case 3:a.x+=e}a.y=Math.round(a.y);a.x=Math.round(a.x)}e=0;c=u();if(c.x!==d.x||c.y!==d.y)b=true}return b};p=function(){return F.getCollision(a)};r=function(){if(q.frame%5===0){k++;switch(k){case 4:k=0;i=-1;break;case 3:i=0}i++}a.frame=l+i*j+a.direction};t=function(){var b=a.direction,c=a.speed,h=d.TYPE,f,g=n.length,i,j;t=function(){r();e+=c;for(f=0;f<g;f++)if(i=n[f],b===i.direction){a[i.prop]+=c*i.sign;if(m()===true&&
(j=p(),j!==false))j.type!==h.CASTLE?a.direction=j[i.order[0]]===1?i.order[0]:j[i.order[1]]===1?i.order[1]:j[i.order[2]]===1?i.order[2]:i.order[3]:B.siege(a,j);break}};t()};a.addEventListener(enchant.Event.ENTER_FRAME,t);a.stay=function(){a.removeEventListener(enchant.Event.ENTER_FRAME,t);a.addEventListener(enchant.Event.ENTER_FRAME,function(){r()})};a.myNo=x.no;x[g][x.no]=a;x.no++;g===c.USER&&(e=-e);o.unit(a);return z({layer:v[g].UNIT,sprite:a})};Score=function(b){var c=d.HAVE,h=b.mode,e=b.x,b=b.y,
f=new Label,g={},a=function(a){g.total+=a;return g.total};f.font="12px "+d.FONT;f.color="#ccc";f.x=e;f.y=b;g={label:f,total:0,rate:0.5,mode:h,point:H().POINT,add:a,update:function(){}};if(h===c.USER)g.update=function(){f.text="SCORE : "+g.total},g.get=function(){return g.total},g.add=function(b){a(b);g.update();return g.total},g.rate=1;g.update();return g};Countdown=function(b){var c=new Label,h=d.TIMELIMIT,e=0,f,g=function(){};c.font="12px "+d.FONT;c.color="#ccc";c.x=b.x;c.y=b.y;c.update=function(){c.text=
"TIME-LIMIT : "+(h-e)};c.init=function(){c.stop();f=setInterval(function(){e++;e>=h&&(g(),c.stop());c.update()},1E3)};c.setAfter=function(a){g=a};c.getDiff=function(){return h-e};c.stop=function(){clearInterval(f)};return c};Effect=function(b){var c=d.UNIT.CHIP_SIZE,h=b.frames[0],e=b.frames[1],f=b.type.toUpperCase(),g=v.EFFECT[f],a=new Sprite(c,c),j=function(){q.frame%3===0&&(a.frame++,a.frame>=e&&(a.removeEventListener(enchant.Event.ENTER_FRAME,j),g.removeChild(a)))};a.image=q.assets[d.EFFECT.IMAGE];
a.x=b.x;a.y=b.y;a.frame=h;a.addEventListener(enchant.Event.ENTER_FRAME,j);return z({layer:g,sprite:a})};var J={aiid:0,race:"",order:[],init:function(){var b=J,c=d.HAVE.ENEMY,h,e,f,g=t.ENEMY,a=g.length,j=d.UNIT.STATUS,k,i,n;switch(D){case "HUMAN":b.race="UNDEAD";b.order="BONE_DOG,BONE_WARRIER,BONE_ARCHER,SHADE,BONE_SNAKE,GOLEM,SPECTOR,ARACHNE".split(",");break;case "UNDEAD":b.race="HUMAN",b.order="LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")}j=j[b.race];k=b.order;b.aiid=
setInterval(function(){i=k.length;i>0&&(f=Math.floor(Math.random()*a),f>=a&&(f=a-1),h=g[f],f=Math.floor(Math.random()*i),f>=i&&(f=i-1),n=k[f],e=j[n],k.splice(f,1),f={mode:c,direction:2,x:h.unitX,y:h.unitY,after_death:function(a){k.push(a.name)}},f=y(f,e),e=new Unit(f))},3E3)},end:function(){clearInterval(J.aiid)}},B={init:function(){u.add(function(){var b=x.USER,c=x.ENEMY,d,e,f,g;for(f in c)if(c.hasOwnProperty(f)===true)for(g in e=c[f],b)b.hasOwnProperty(g)===true&&(d=b[g],e.intersect(d)===true&&
(d.x===e.x||d.y===e.y)&&B.unitAndUnit(e,d))},"battle")},score:function(b){var c=d.HAVE,h=b.mode,e=d.TYPE,b=b.type,f=K,g=d.POINT;b!==e.CASTLE&&h===c.USER||b===e.CASTLE&&h===c.ENEMY?f.add(g[b]):b===e.CASTLE&&h===c.USER&&f.add(-g[b])},unitAndUnit:function(b,c){for(var d=b.hp,e=c.hp;d>0&&e>0;)d=b.attack(c),e=c.attack(b);b.checkDeath()===true&&(o.death(b),B.score(b));c.checkDeath()===true&&(o.death(c),B.score(c));F.vibrate(1)},siege:function(b,c){o.siege(c);c.damage(b);b.kill();F.vibrate(3);c.checkBreak()===
true&&(o.castle(c),B.score(c))}},u={functions:{},exefunc:function(){var b,c=u.functions;for(b in c)if(c.hasOwnProperty(b)===true)c[b]()},add:function(b,c){u.functions[c]=b},remove:function(b){delete u.functions[b]},init:function(){q.addEventListener(enchant.Event.ENTER_FRAME,u.exefunc,false)},stop:function(){q.removeEventListener(enchant.Event.ENTER_FRAME,u.exefunc,false)},end:function(){u.functions={};u.stop()}};StatusViwer=function(){var b=new Label,c=new Group,h,e=d.STATUS_VIEWER,f=e.POSITION,
g=q.assets[e.IMAGE],e=e.BG_SIZE,a=new Sprite(e[0],e[1]),j=d.UNIT.STATUS,e=d.HAVE.USER,k={};c.x=f[0];c.y=f[1];a.image=g;a.frame=0;a.opacity=0;b.font="9px/1.5 "+d.FONT;b.color="#fff";b.text="";b.x=45;b.y=8;h=new Unit({mode:e,x:15,y:15,opacity:0});h.frame=0;h.direction=2;h.stay();c.update=function(a){h.opacity=1;c.update=function(a){b.text=k[a.name];h.changeUnit(a)};c.update(a)};c.init=function(){var b,c,d=j[D];for(b in d)d.hasOwnProperty(b)===true&&(c=d[b],k[b]="<b>"+c.name+"</b><br />HP: "+c.hp+"<br />Armor: "+
c.armor+"<br />Damage: "+c.damage+"<br />Speed: "+c.speed+"<br />DownTime: "+c.reverse+"sec");a.opacity=1};c.addChild(a);c.addChild(b);c.addChild(h);return c};var o={logid:0,data:{time:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}},unit:function(b){o.data.unit[b.mode]++},death:function(b){o.data.death[b.mode]++},siege:function(b){o.data.siege[b.mode]++},castle:function(b){o.data.castle[b.mode]++},send:function(){o.data.time=G.getDiff();console.log(JSON.stringify(o.data))},
reset:function(){o.data={time:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}}},init:function(){o.reset();o.end();o.logid=setInterval(o.send,3E4)},end:function(){o.send();clearInterval(o.logid)}};Result=function(b){var c=new Scene,h=new Label,e=new Label,f=d.HAVE,g=K.get(),a=d.POINT,j;j="SCORE: "+g+"<br>";switch(b){case f.ENEMY:b="WIN";f=G.getDiff()*a.TIME;j+="&nbsp;WIN: "+a.WIN+"<br>&nbsp;CLEAR TIME BONUS: "+f;g+=a.WIN+f;break;case f.USER:b="LOSE";j+=
"&nbsp;LOSE: "+a.LOSE;g+=a.LOSE;break;default:b="DRAW",j+="&nbsp;DRAW: 0"}j+="<br><br><b>TOTAL: "+g+"</b>";a=d.FONT;h.font="20px/1.5 "+a;h.color="#fff";h.text="RESULT";h.x=100;h.y=100;e.font="12px/1.5 "+a;e.color="#fff";e.text=j;e.x=100;e.y=150;c.addChild(h);c.addChild(e);c.backgroundColor="rgba(0,0,0,0.3)";q.pushScene(c);q.end(g,b+":"+g)};return R}(window);AW.init({map:"\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7\u25a0\u00d7,\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502\u00d7,\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524\u00d7,\u2502\u00d7\u2514\u2510\u2502\u00d7\u2502\u00d7,\u2514\u2510\u00d7\u251c\u2524\u00d7\u2514\u2510,\u00d7\u2502\u00d7\u2502\u2514\u2510\u00d7\u2502,\u00d7\u251c\u2500\u2524\u00d7\u2502\u00d7\u2502,\u00d7\u2502\u00d7\u2502\u00d7\u251c\u2500\u2524,\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1\u00d7\u25a1".split(",")});
