enchant();
var AW=function(D){var R=function(){D.pageYOffset===0&&D.scrollTo(0,1)};D.onorientationchange=function(){setTimeout(R,100)};D.addEventListener("load",D.onorientationchange,false);var t,N,v={USER:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},ENEMY:{UNIT:new Group,CASTLE:new Group,THUMB:new Group},MAP_OPTION:{CASTLE_BASE:new Group,THUMB_BASE:new Group},EFFECT:{UNIT:new Group}},E="",A={USER:{},ENEMY:{},no:0},O={USER:[],ENEMY:[]},y={USER:[],ENEMY:[]},K={},H={},L={},M=[],F={USER:[],ENEMY:[]},P=[],
G={},B=function(b,c){b===void 0&&(b={});for(var d in c)c.hasOwnProperty(d)===true&&(b[d]=c[d]);return b},z=function(b){b.layer.addChild(b.sprite);return b.sprite},Q={},I=function(){return{TIMELIMIT:function(){return 180},FONT:function(){return"monospace"},UNIT:function(){return{IMAGE:"char.gif",CHIP_SIZE:16,FRAME_SIZE:{W:4,H:3},FRAME_LINE:16,FRAME_BLOCK:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:4,KNIGHT:8,ARCHER:12,CLELIC:16,FIRE_MAGE:20,FROST_MAGE:24,WIZARD:28},UNDEAD:{BONE_DOG:32,BONE_WARRIER:36,BONE_ARCHER:40,
SPECTOR:44,BONE_SNAKE:48,GOLEM:52,SHADE:56,ARACHNE:60}},STATUS:{HUMAN:{WARRIOR:{name:"WARRIOR",frame:0,hp:3,armor:"MIDIUM",speed:2,damage:3,siege:1,reverse:5,attacked:function(){},dead:function(){}},LANCER:{name:"LANCER",frame:4,hp:4,armor:"MIDIUM",speed:2,damage:2,siege:1,reverse:3,attacked:function(){},dead:function(){}},KNIGHT:{name:"KNIGHT",frame:8,hp:5,armor:"HEAVY",speed:1.8,damage:2,siege:1,reverse:8,attacked:function(){},dead:function(){}},ARCHER:{name:"ARCHER",frame:12,hp:2,armor:"LIGHT",
speed:2.2,damage:3,siege:1,reverse:4,attacked:function(){},dead:function(){}},CLELIC:{name:"CLELIC",frame:48,hp:2,armor:"NOARMOR",speed:1,damage:1,siege:1,reverse:3,attacked:function(){},dead:function(){}},FIRE_MAGE:{name:"FIRE_MAGE",frame:52,hp:2,armor:"NOARMOR",speed:1.6,damage:2,siege:1,reverse:4,attacked:function(){},dead:function(b){b=b.mine;b=new Effect({type:b.type.toUpperCase(),x:b.x,y:b.y,frames:d.EFFECT.FRAME.FIRE});z({layer:v.EFFECT.UNIT,sprite:b})}},FROST_MAGE:{name:"FROST_MAGE",frame:56,
hp:2,armor:"NOARMOR",speed:1.6,damage:2,siege:1,reverse:4,attacked:function(){},dead:function(){}},WIZARD:{name:"WIZARD",frame:60,hp:2,armor:"NOARMOR",speed:1.6,damage:3,siege:1,reverse:5,attacked:function(){},dead:function(){}}},UNDEAD:{BONE_DOG:{name:"BONE_DOG",frame:96,hp:1,armor:"LIGHT",speed:2.8,damage:2,siege:1,reverse:1,attacked:function(){},dead:function(){}},BONE_WARRIER:{name:"BONE_WARRIER",frame:100,hp:2,armor:"MIDIUM",speed:2,damage:2,siege:1,reverse:1,attacked:function(){},dead:function(){}},
BONE_ARCHER:{name:"BONE_ARCHER",frame:104,hp:1,armor:"MIDIUM",speed:2,damage:3,siege:1,reverse:1,attacked:function(){},dead:function(){}},SHADE:{name:"SHADE",frame:108,hp:1,armor:"NOARMOR",speed:1.8,damage:0,siege:9,reverse:3,attacked:function(){},dead:function(){}},BONE_SNAKE:{name:"BONE_SNAKE",frame:144,hp:2,armor:"LIGHT",speed:2.6,damage:1,siege:1,reverse:1,attacked:function(){},dead:function(){}},GOLEM:{name:"GOLEM",frame:148,hp:7,armor:"HEAVY",speed:1,damage:2,siege:1,reverse:6,attacked:function(){},
dead:function(){}},SPECTOR:{name:"SPECTOR",frame:152,hp:1,armor:"NOARMOR",speed:1.8,damage:9,siege:0,reverse:3,attacked:function(){},dead:function(){}},ARACHNE:{name:"ARACHNE",frame:156,hp:3,armor:"MIDIUM",speed:2,damage:3,siege:1,reverse:4,attacked:function(b){b=b.enemy;b.reverse=9;b.speed/=2},dead:function(){}}}},AI:{USER:[{direction:0,prop:"y",sign:-1,order:[1,3,0,2]},{direction:3,prop:"x",sign:-1,order:[0,2,3,1]},{direction:1,prop:"x",sign:1,order:[0,2,1,3]},{direction:2,prop:"y",sign:1,order:[3,
1,2,0]}],ENEMY:[{direction:2,prop:"y",sign:1,order:[3,1,2,0]},{direction:3,prop:"x",sign:-1,order:[2,0,3,1]},{direction:1,prop:"x",sign:1,order:[2,0,1,3]},{direction:0,prop:"y",sign:1,order:[3,1,0,2]}]}}},THUMB:function(){return{IMAGE:"thumb.png",CHIP_SIZE:48,FRAME:{HUMAN:{LANCER:0,WARRIOR:1,KNIGHT:2,ARCHER:3,CLELIC:4,FIRE_MAGE:5,FROST_MAGE:6,WIZARD:7},UNDEAD:{BONE_DOG:8,BONE_SNAKE:9,BONE_WARRIER:10,BONE_ARCHER:11,GOLEM:12,ARACHNE:13,SHADE:14,SPECTOR:15}},USER:{POSITION:[[0,384],[48,384],[96,384],
[144,384],[0,432],[48,432],[96,432],[144,432]]},ENEMY:{},PROP:{}}},SCORE:function(){return{POSITION:[20,7]}},COUNTDOWN:function(){return{POSITION:[200,7]}},STATUS_VIEWER:function(){return{IMAGE:"window_status.png",POSITION:[192,384],BG_SIZE:[128,96]}},MAP:function(){return{IMAGE:"map.png",W:320,H:480,CHIP_SIZE:32}},CASTLE:function(){return{FRAME:[{NORMAL:8,BRAKE:9},{NORMAL:10,BRAKE:11},{NORMAL:12,BRAKE:13},{NORMAL:14,BRAKE:15}],PROP:{frame:0,brake:0,hp:2,mhp:2,unitX:0,unitY:0}}},EFFECT:function(){return{IMAGE:"effect.gif",
FRAME:{EXPLOSION:{start:0,end:5,rate:3,loop:false},FIRE:{start:5,end:7,rate:50,loop:true},FROST:{start:5,end:7,rate:10,loop:true}}}},SOUND:function(){return{BGM:"bgm.wav",EFFECT:{EXPLOSION:"explosion.wav"}}},TYPE:function(){return{CASTLE:"CASTLE",THUMB:"THUMB",UNIT:"UNIT",EFFECT:"EFFECT"}},HAVE:function(){return{USER:"USER",ENEMY:"ENEMY"}},POINT:function(){return{UNIT:10,CASTLE:1E3,WIN:5E3,LOSE:-5E3,TIME:100}}}},d=I(),d={TIMELIMIT:d.TIMELIMIT(),FONT:d.FONT(),UNIT:d.UNIT(),THUMB:d.THUMB(),SCORE:d.SCORE(),
COUNTDOWN:d.COUNTDOWN(),STATUS_VIEWER:d.STATUS_VIEWER(),MAP:d.MAP(),CASTLE:d.CASTLE(),EFFECT:d.EFFECT(),SOUND:d.SOUND(),TYPE:d.TYPE(),HAVE:d.HAVE(),POINT:d.POINT()};Q.init=function(){var b=d.UNIT.IMAGE,c=d.THUMB.IMAGE,h=d.MAP.IMAGE,g=d.EFFECT.IMAGE,k=d.STATUS_VIEWER.IMAGE,i=d.MAP.W,a=d.MAP.H,e,j,f;e=["\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7,\u25a0,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),
"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7,\u00d7".split(","),"\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1,\u00d7,\u25a1".split(",")];var r=e.length-2,o=e[0].length-2;j=[];var q,l,p,n,m,s;l=Math.floor;var x=Math.random;for(f=
0;f<4;f++){p=f*2;n=l(x()*r)+1;for(q=1;q<=r;q++)m=e[q],q===n?(m[p]="\u2514",m[p+1]="\u2510",p+=1):m[p]="\u2502"}for(f=0;f<o;f++)for(q=1;q<=r;q++)m=e[q],n=m[f],n==="\u2502"&&(n=m[f+1],p=m[f+2],s=m[f+3],(n==="\u2502"||n==="\u00d7"&&p==="\u2502"||f+3<=7&&n==="\u00d7"&&p==="\u00d7"&&s==="\u2502")&&j.push({x:f,y:q}));r=j.length-1;for(f=0;f<100;f++)n=l(x()*r)+1,m=j[0],j[0]=j[n],j[n]=m;for(f=0;f<j.length&&f<3;f++)m=j[f],l=m.x,p=m.y,m=e[p],n=l+1,p=l+2,s=l+3,m[l]==="\u2502"&&m[n]==="\u2502"?(m[l]="\u251c",
m[n]="\u2524"):m[l]==="\u2502"&&m[n]==="\u00d7"&&m[p]==="\u2502"?(m[l]="\u251c",m[n]="\u2500",m[p]="\u2524"):m[l]==="\u2502"&&m[n]==="\u00d7"&&m[p]==="\u00d7"&&m[s]==="\u2502"?(m[l]="\u251c",m[n]="\u2500",m[p]="\u2500",m[s]="\u2524"):(j.splice(f,1),f--);for(f=0,r=e.length;f<r;f++)e[f]=e[f].join("");M=e;for(j=0,f=e.length;j<f;j++)e[j]=e[j].split("");j={0:0,1:0,2:0,3:0,4:0,5:0,6:0,7:0,24:0,26:0,27:0,28:0,29:0,30:0,31:0,32:0,33:0,34:0,35:0,36:0,37:0,38:0,39:0,40:0,41:0,42:0,43:0,44:0,45:0,46:0,47:0,
48:0,49:0,50:0,51:0,52:0,25:[0,0,1,0],99:[1,0,0,0],16:[1,0,1,0],17:[0,1,0,1],18:[1,1,1,0],19:[1,0,1,1],20:[0,1,1,0],21:[0,0,1,1],22:[1,1,0,0],23:[1,0,0,1]};q=[];e=[].concat([[26,27,28,29,30,31,32,33,34,35],[0,1,1,1,1,1,1,1,1,2]],e,[[5,6,6,6,6,6,6,6,6,7],[36,37,38,39,40,41,42,43,44,45],[46,47,48,49,50,51,52,46,47,48],[49,50,51,52,51,52,46,47,48,49]]);for(f=0,x=e.length;f<x;f++){r=q[f]=[];o=e[f];o.length===8&&(e[f]=o=["3"].concat(o,"4"));for(l=0,m=o.length;l<m;l++){n=o;p=l;s=o[l];switch(s){case "\u2502":s=
16;break;case "\u2500":s=17;break;case "\u251c":s=18;break;case "\u2524":s=19;break;case "\u250c":s=20;break;case "\u2510":s=21;break;case "\u2514":s=22;break;case "\u2518":s=23;break;case "\u00d7":s=24;break;case "\u25a0":s=25;break;case "\u25a1":s=99}n[p]=s;r[l]=j[o[l]];switch(o[l]){case 25:F.ENEMY.push([l,f]);break;case 99:F.USER.push([l,f]),o[l]=25}}}M=e;P=q;t=new Game(i,a);t.preload(b,c,h,g,k);t.onload=Amida;t.start()};RaceSelect=function(){var b=d.THUMB,c=b.CHIP_SIZE,h=b.FRAME.HUMAN,g=b.FRAME.UNDEAD,
k=new Scene,i=t.assets[b.IMAGE],a=t.assets[d.STATUS_VIEWER.IMAGE],e=new Group,j=new Sprite(c,c),f=new Label,r=new Label,o=new Sprite(250,100),q=new Group,c=new Sprite(c,c),l=new Label,p=new Label,n=new Sprite(250,100),m=function(a){var c,e,f,g,h=new Label,k=O.USER,i=d.HAVE.USER,j=b.USER.POSITION,l=b.FRAME;E=a.race;f=a.order;for(c=0,e=f.length;c<e;c++)a=f[c].toUpperCase(),g=j[c],k[c]=new Thumb({mode:i,name:a,frame:l[E][a],x:g[0],y:g[1]});h.text="\u2462";h.font="150px/1.5 "+d.FONT;h.color="#fff";h.x=
90;h.y=100;t.rootScene.addChild(h);L.init();t.popScene();aid=setTimeout(function(){h.text="\u2461";aid=setTimeout(function(){h.text="\u2460";aid=setTimeout(function(){G.vibrate(3);for(c=0,e=f.length;c<e;c++)k[c].init();u.init();J.init();H.init();t.rootScene.removeChild(h)},1E3)},1E3)},1E3)};k.backgroundColor="rgba(0,0,0,0.3)";j.image=c.image=i;o.image=n.image=a;o.frame=n.frame=1;e.addChild(o);q.addChild(n);e.x=q.x=35;e.y=100;q.y=220;j.frame=h.KNIGHT;c.frame=g.BONE_WARRIER;j.x=c.x=5;j.y=c.y=5;f.font=
r.font=l.font=p.font="12px/1.5 "+d.FONT;f.color=r.color=l.color=p.color="#ddd";f.text="<b>HUMAN</b>";l.text="<b>UNDEAD</b>";r.text="\u4f7f\u3044\u3084\u3059\u304f\u3001\u9ad8\u6027\u80fd\u306a\u7a2e\u65cf\u3002\u30d0\u30e9\u30f3\u30b9\u304c\u826f\u304f\u6271\u3044\u3084\u3059\u3044\u3002";p.text="\u6271\u3044\u3065\u3089\u3044\u5c16\u3063\u305f\u6027\u80fd\u3092\u6301\u3064\u30e6\u30cb\u30c3\u30c8\u304c\u591a\u3044\u7a2e\u65cf\u3002<br />\u64cd\u4f5c\u91cf\u306b\u81ea\u4fe1\u304c\u3042\u308b\u4eba\u5411\u3051\u3002";
f.x=l.x=50;f.y=l.y=5;r.width=p.width=200;r.x=p.x=50;r.y=p.y=23;e.addChild(j);e.addChild(f);e.addChild(r);q.addChild(c);q.addChild(l);q.addChild(p);k.addChild(e);k.addChild(q);e.addEventListener(enchant.Event.TOUCH_END,function(){m({race:"HUMAN",order:"LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")})});q.addEventListener(enchant.Event.TOUCH_END,function(){m({race:"UNDEAD",order:"BONE_WARRIER,BONE_ARCHER,BONE_DOG,BONE_SNAKE,GOLEM,ARACHNE,SHADE,SPECTOR".split(",")})});t.pushScene(k)};
Amida=function(){var b=d.MAP.CHIP_SIZE,c=M,h=new Map(b,b),g=t.assets[d.MAP.IMAGE],k=v.USER,i=v.ENEMY,a=d.CASTLE.FRAME,e=d.HAVE.USER,j=v.MAP_OPTION.CASTLE_BASE,f=v.MAP_OPTION.THUMB_BASE,r=v.EFFECT.UNIT,o=t.rootScene,q=d.UNIT.CHIP_SIZE,l=d.SCORE.POSITION,p,n=d.COUNTDOWN.POSITION,m=d.STATUS_VIEWER.POSITION,s,x;N=document.getElementById("enchant-stage");h.image=g;h.loadData(c);h.vibrate=function(a){var b=N.style;a+="px";clearInterval(x);x=setTimeout(function(){b.top=0;b.left=a;x=setTimeout(function(){b.top=
a;b.left=0;x=setTimeout(function(){b.top=0;b.left="-"+a;x=setTimeout(function(){b.top=0;b.left=0},30)},30)},30)},30)};h.getSquere=function(a){var c,e,f=Math.floor;h.getSquere=function(a){c=f(a.x/b);e=f(a.y/b);return{x:c,y:e}};return h.getSquere(a)};h.getCollision=function(a){var b=h.getSquere(a),c=P,e=false,f,d,g;if((c=c[b.y])&&(c=c[b.x]))if(c[0]+c[1]+c[2]+c[3]===1)for(f in y){if(y.hasOwnProperty(f)===true){d=y[f];for(b=0,c=d.length;b<c;b++)if(g=d[b],a.intersect(g)===true){e=g;break}}}else e=c;return e};
G=h;statusViewer=L=new StatusViwer({mode:e,x:m[0],y:m[1]});c=K=new Score({mode:e,x:l[0],y:l[1]});p=H=new Countdown({x:n[0],y:n[1]});p.update();for(s in F)if(F.hasOwnProperty(s)===true){e=F[s];for(n=0,g=e.length;n<g;n++)l=new Castle({mode:s,frame:a[n].NORMAL,brake:a[n].BRAKE,x:e[n][0]*b,y:e[n][1]*b}),l.unitX=l.x+q/2,l.unitY=l.y+q/2}o.addChild(h);o.addChild(j);o.addChild(statusViewer);o.addChild(f);o.addChild(i.CASTLE);o.addChild(i.UNIT);o.addChild(k.UNIT);o.addChild(k.CASTLE);o.addChild(k.THUMB);o.addChild(i.THUMB);
o.addChild(r);o.addChild(c.label);o.addChild(p);C.init();(function(){var a=false,b=function(){new Result(a);w.end();J.end();u.end();p.stop()};w.add(function(){return gameStart===true?(new RaceSelect,p.setAfter(function(){a=true;b();return true}),w.remove("playStart"),true):false},"playStart");w.add(function(){var c,e,f,d,h,g;if(a!==false)return b(),true;for(c in y)if(y.hasOwnProperty(c)===true){d=y[c];f=d.length;for(e=g=0;e<f;e++)if(h=d[e],h.hp>0)break;else g++;if(g===f){a=c;break}}return false},
"playEnd");w.init()})()};Castle=function(b){var c=d.MAP.CHIP_SIZE,h=t.assets[d.MAP.IMAGE],g=I().CASTLE().PROP,k=b.mode.toUpperCase(),i=d.HAVE,a=new Sprite(c,c),e=v.MAP_OPTION.CASTLE_BASE,j=-1,f,c=new Sprite(c,c);c.image=h;c.frame=24;if(k===i.USER)c.frame=16;c.x=b.x;c.y=b.y;z({layer:e,sprite:c});g.base=c;g=B(g,b);a.image=h;a=B(a,g);a.type=d.TYPE.CASTLE;y[k].push(a);a.focusOn=function(){a.scaleX=a.scaleY=1.4;a.focus=true};a.focusOff=function(){a.scaleX=a.scaleY=1;a.focus=false};f=function(){t.frame%
2===0&&(a.opacity+=0.1*j,a.opacity<=0.5?j=1:a.opacity>=1&&(j=-1))};a.blinkOn=function(){a.addEventListener(enchant.Event.ENTER_FRAME,f)};a.blinkOff=function(){a.removeEventListener(enchant.Event.ENTER_FRAME,f);a.opacity=1};a.damage=function(b){a.hp-=b.siege;if(a.hp<=0)a.hp=0,a.broke();else if(a.mhp/2>=a.hp)a.frame=a.brake};a.broke=function(){a.hp=a.opacity=a.base.opacity=0};a.checkBreak=function(){return a.hp===0?true:false};return z({layer:v[k].CASTLE,sprite:a})};Thumb=function(b){var c=d.THUMB.CHIP_SIZE,
h=t.assets[d.THUMB.IMAGE],g=I().THUMB().PROP,k=d.UNIT.STATUS[E][b.name],i=b.mode.toUpperCase(),a=new Sprite(c,c),c=new Sprite(c,c),e,j,f,r,o=enchant.Event,q=L,l=new Label;c.image=h;c.frame=16;c.x=b.x;c.y=b.y;z({layer:v.MAP_OPTION.THUMB_BASE,sprite:c});l.text=Math.ceil(k.reverse);l.font="24px "+d.FONT;l.color="#ccc";l.x=b.x+17;l.y=b.y+7;z({layer:v.MAP_OPTION.THUMB_BASE,sprite:l});g=B(g,b);a.image=h;a=B(a,g);a.unit={mode:i};a.unit=B(a.unit,k);a.type=d.TYPE.THUMB;f=a.x;r=a.y;a.addEventListener(o.TOUCH_START,
function(b){this.canDrag===true&&(e=b.x-this.x,j=b.y-this.y);q.update(a.unit)});a.addEventListener(o.TOUCH_MOVE,function(a){if(this.canDrag===true)this.x=a.x-e,this.y=a.y-j});a.addEventListener(o.TOUCH_END,function(){if(this.canDrag===true){var a;a=false;var b=y.USER,c,e,d;for(e=0,d=b.length;e<d;e++)if(c=b[e],this.intersect(c)===true){a=c;break}if(a!==false)this.dragStop(),this.unit.x=a.unitX,this.unit.y=a.unitY,this.lastUnit=new Unit(this.unit),this.lastUnit.thumb=this;this.x=f;this.y=r}});a.dragStart=
function(){a.canDrag=true;a.opacity=1};a.dragStop=function(){a.canDrag=false;a.opacity=0};a.reverse=function(b){var c=Math.ceil(b.reverse),e=setInterval(function(){c--;l.text=c;if(c===0)l.text="",a.dragStart(),clearInterval(e)},1E3);l.text=c;a.opacity=0.3};O[i].push(a);a.dragStop();a.opacity=0.3;a.init=function(){a.reverse(a.unit)};return z({layer:v[i].THUMB,sprite:a})};Unit=function(b){var c=d.UNIT.CHIP_SIZE,h=d.MAP.CHIP_SIZE,g=c/2,k=t.assets[d.UNIT.IMAGE],i=b.mode.toUpperCase(),a=new Sprite(c,c),
e=new Label,c=d.HAVE,j=d.UNIT.FRAME_LINE,f=0,r=0,o=d.UNIT.AI[i],q,l,p,n,m,s;a.direction=0;a.image=k;a=B(a,b);a.hplabel=e;e.x=b.x-12;e.y=b.y-14;e.font="9px "+d.FONT;e.color="#FAA";e.backgroundColor="rgba(0,0,0,0.5)";e.width=40;e.update=function(){e.text="\u2020"+a.damage+"/\u2665"+a.hp};e.update();z({layer:v[i].UNIT,sprite:e});a.type=d.TYPE.UNIT;a.attack=function(b){b.hp-=a.damage;a.attacked({mine:a,enemy:b});b.hplabel.update();b.hp<=0&&(b.dead({mine:a,enemy:b}),b.kill());return b.hp};a.kill=function(){var b=
a.x,c=a.y;new Effect({type:a.type.toUpperCase(),x:b,y:c,frames:d.EFFECT.FRAME.EXPLOSION});delete A[i][a.myNo];v[i].UNIT.removeChild(a);v[i].UNIT.removeChild(e);typeof a.after_death==="function"&&setTimeout(function(){a.after_death(a)},a.reverse*1E3);a.thumb!==void 0&&a.thumb.reverse(a)};a.checkDeath=function(){return a.hp===0?true:false};q=a.frame;a.changeUnit=function(a){q=a.frame};l=function(){return G.getSquere(a)};a.beforePoint=l();p=function(){var b=false;if(g>=h){var c,e=a.beforePoint;g-=h;
if(g>0){switch(a.direction){case 0:a.y+=g;break;case 1:a.x-=g;break;case 2:a.y-=g;break;case 3:a.x+=g}a.y=Math.round(a.y);a.x=Math.round(a.x)}g=0;c=l();if(c.x!==e.x||c.y!==e.y)b=true}return b};n=function(){return G.getCollision(a)};m=function(){if(t.frame%5===0){f++;switch(f){case 4:f=0;r=-1;break;case 3:r=0}r++}a.frame=q+r*j+a.direction};s=function(){var b=a.direction,c=a.speed,f=d.TYPE,h,k=o.length,i,j;s=function(){if(t.frame%3===0){m();g+=c;for(h=0;h<k;h++)if(i=o[h],b===i.direction){a[i.prop]+=
c*i.sign;e[i.prop]+=c*i.sign;if(p()===true&&(j=n(),j!==false))j.type!==f.CASTLE?a.direction=j[i.order[0]]===1?i.order[0]:j[i.order[1]]===1?i.order[1]:j[i.order[2]]===1?i.order[2]:i.order[3]:C.siege(a,j);break}}};s()};a.addEventListener(enchant.Event.ENTER_FRAME,s);a.stay=function(){v[i].UNIT.removeChild(e);a.removeEventListener(enchant.Event.ENTER_FRAME,s);a.addEventListener(enchant.Event.ENTER_FRAME,function(){m()})};a.myNo=A.no;A[i][A.no]=a;A.no++;if(i===c.USER)g=-g,e.color="#AAF";u.unit(a);return z({layer:v[i].UNIT,
sprite:a})};Score=function(b){var c=d.HAVE,h=b.mode,g=b.x,b=b.y,k=new Label,i={},a=function(a){i.total+=a;return i.total};k.font="12px "+d.FONT;k.color="#ccc";k.x=g;k.y=b;i={label:k,total:0,rate:0.5,mode:h,point:I().POINT,add:a,update:function(){}};if(h===c.USER)i.update=function(){k.text="SCORE : "+i.total},i.get=function(){return i.total},i.add=function(b){a(b);i.update();return i.total},i.rate=1;i.update();return i};Countdown=function(b){var c=new Label,h=d.TIMELIMIT,g=0,k,i=function(){};c.font=
"12px "+d.FONT;c.color="#ccc";c.x=b.x;c.y=b.y;c.update=function(){c.text="TIME-LIMIT : "+(h-g)};c.init=function(){c.stop();k=setInterval(function(){g++;g>=h&&(i(),c.stop());c.update()},1E3)};c.setAfter=function(a){i=a};c.getDiff=function(){return h-g};c.stop=function(){clearInterval(k)};return c};Effect=function(b){var c=d.UNIT.CHIP_SIZE,h=b.frames,g=h.start,k=h.end,i=h.rate,h=h.loop,a=b.type.toUpperCase(),e=v.EFFECT[a],j=new Sprite(c,c),f;f=h===true?function(){if(t.frame%i===0)j.frame>=k?j.frame=
g:j.frame++,console.log(t.frame+":"+j.frame)}:function(){t.frame%i===0&&(j.frame++,j.frame>=k&&j.end())};j.image=t.assets[d.EFFECT.IMAGE];j.x=b.x;j.y=b.y;j.frame=g;j.addEventListener(enchant.Event.ENTER_FRAME,f);j.end=function(){j.removeEventListener(enchant.Event.ENTER_FRAME,f);e.removeChild(j)};return z({layer:e,sprite:j})};var J={aiid:0,race:"",order:[],init:function(){var b=J,c=d.HAVE.ENEMY,h,g,k,i=y.ENEMY,a=i.length,e=d.UNIT.STATUS,j,f,r;switch(E){case "HUMAN":b.race="UNDEAD";b.order="BONE_DOG,BONE_WARRIER,BONE_ARCHER,SHADE,BONE_SNAKE,GOLEM,SPECTOR,ARACHNE".split(",");
break;case "UNDEAD":b.race="HUMAN",b.order="LANCER,WARRIOR,KNIGHT,ARCHER,CLELIC,FIRE_MAGE,FROST_MAGE,WIZARD".split(",")}e=e[b.race];j=b.order;b.aiid=setInterval(function(){f=j.length;f>0&&(k=Math.floor(Math.random()*a),k>=a&&(k=a-1),h=i[k],k=Math.floor(Math.random()*f),k>=f&&(k=f-1),r=j[k],g=e[r],j.splice(k,1),k={mode:c,direction:2,x:h.unitX,y:h.unitY,after_death:function(a){j.push(a.name)}},k=B(k,g),g=new Unit(k))},3E3)},end:function(){clearInterval(J.aiid)}},C={init:function(){w.add(function(){var b=
A.USER,c=A.ENEMY,d,g,k,i;for(k in c)if(c.hasOwnProperty(k)===true)for(i in g=c[k],b)b.hasOwnProperty(i)===true&&(d=b[i],g.intersect(d)===true&&(d.x===g.x||d.y===g.y)&&C.unitAndUnit(g,d))},"battle")},score:function(b){var c=d.HAVE,h=b.mode,g=d.TYPE,b=b.type,k=K,i=d.POINT;b!==g.CASTLE&&h===c.USER||b===g.CASTLE&&h===c.ENEMY?k.add(i[b]):b===g.CASTLE&&h===c.USER&&k.add(-i[b])},unitAndUnit:function(b,c){for(var d=b.hp,g=c.hp;d>0&&g>0;)d=b.attack(c),g=c.attack(b);b.checkDeath()===true&&(u.death(b),C.score(b));
c.checkDeath()===true&&(u.death(c),C.score(c))},siege:function(b,c){u.siege(c);c.damage(b);b.kill();G.vibrate(3);c.checkBreak()===true&&(u.castle(c),C.score(c))}},w={functions:{},exefunc:function(){var b,c=w.functions;for(b in c)if(c.hasOwnProperty(b)===true)c[b]()},add:function(b,c){w.functions[c]=b},remove:function(b){delete w.functions[b]},init:function(){t.addEventListener(enchant.Event.ENTER_FRAME,w.exefunc,false)},stop:function(){t.removeEventListener(enchant.Event.ENTER_FRAME,w.exefunc,false)},
end:function(){w.functions={};w.stop()}};StatusViwer=function(){var b=new Label,c=new Group,h,g=d.STATUS_VIEWER,k=g.POSITION,i=t.assets[g.IMAGE],g=g.BG_SIZE,a=new Sprite(g[0],g[1]),e=d.UNIT.STATUS,g=d.HAVE.USER,j={};c.x=k[0];c.y=k[1];a.image=i;a.frame=0;a.opacity=0;b.font="9px/1.5 "+d.FONT;b.color="#fff";b.text="";b.x=45;b.y=8;h=new Unit({mode:g,x:15,y:15,opacity:0});h.frame=0;h.direction=2;h.stay();c.update=function(a){h.opacity=1;c.update=function(a){b.text=j[a.name];h.changeUnit(a)};c.update(a)};
c.init=function(){var b,c,d=e[E];for(b in d)d.hasOwnProperty(b)===true&&(c=d[b],j[b]="<b>"+c.name+"</b><br />\u2020: "+c.damage+" \u2665: "+c.hp+"<br />\u0398: "+c.armor+"<br />\u21d2: "+c.speed+"/frame<br />\u00d7: "+c.reverse+"sec");a.opacity=1};c.addChild(a);c.addChild(b);c.addChild(h);return c};var u={logid:0,data:{time:0,victory:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}},unit:function(b){u.data.unit[b.mode]++},death:function(b){u.data.death[b.mode]++},
siege:function(b){u.data.siege[b.mode]++},castle:function(b){u.data.castle[b.mode]++},send:function(){u.data.time=H.getDiff();httpRequest=false;if(window.XMLHttpRequest)httpRequest=new XMLHttpRequest,httpRequest.overrideMimeType("text/xml");else if(window.ActiveXObject)try{httpRequest=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){httpRequest=new ActiveXObject("Microsoft.XMLHTTP")}httpRequest.open("POST","/amidawars/log.php",true);httpRequest.onreadystatechange=function(b){console.log(b)};httpRequest.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");httpRequest.send("log="+JSON.stringify(u.data))},reset:function(){u.data={time:0,unit:{USER:0,ENEMY:0},death:{USER:0,ENEMY:0},siege:{USER:0,ENEMY:0},castle:{USER:0,ENEMY:0}}},init:function(){u.reset()},end:function(){u.send();clearInterval(u.logid)}};Result=function(b){var c=new Scene,h=new Label,g=new Label,k=d.HAVE,i=K.get(),a=d.POINT,e;e="SCORE: "+i+"<br>";switch(b){case k.ENEMY:b="WIN";u.data.victory=1;k=H.getDiff()*a.TIME;e+="&nbsp;WIN: "+a.WIN+"<br>&nbsp;CLEAR TIME BONUS: "+
k;i+=a.WIN+k;break;case k.USER:b="LOSE";u.data.victory=-1;e+="&nbsp;LOSE: "+a.LOSE;i+=a.LOSE;break;default:b="DRAW",e+="&nbsp;DRAW: 0"}e+="<br><br><b>TOTAL: "+i+"</b>";a=d.FONT;h.font="20px/1.5 "+a;h.color="#fff";h.text="RESULT";h.x=100;h.y=100;g.font="12px/1.5 "+a;g.color="#fff";g.text=e;g.x=100;g.y=150;c.addChild(h);c.addChild(g);c.backgroundColor="rgba(0,0,0,0.3)";t.pushScene(c);t.end(i,b+":"+i)};return Q}(window);AW.init({});
